<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<title>imageMap.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.1.5 on Thu Sep 28 15:37:57 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>imageMap.C</h1><a href="imageMap.C.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">// ***************************************************************************</font>
00002 <font class="comment">// *  IMAGEMAP.C                                                             *</font>
00003 <font class="comment">// *                                                                         *</font>
00004 <font class="comment">// *  Author : Ireneusz Karkowski 1991                                       *</font>
00005 <font class="comment">// *    @(#)imageMap.C 1.8 08/22/94 Delft University of Technology </font>
00006 <font class="comment">// ***************************************************************************</font>
00007 
00008 
00009 <font class="preprocessor">#include "<a class="code" href="cricand.h.html">cricand.h</a>"</font>
00010 <font class="preprocessor">#include "<a class="code" href="imageMap.h.html">imageMap.h</a>"</font>
00011 <font class="preprocessor">#ifndef __MSDOS__
</font>00012 <font class="preprocessor"></font><font class="preprocessor">#include &lt;malloc.h&gt;</font>
00013 <font class="preprocessor">#else
</font>00014 <font class="preprocessor"></font><font class="preprocessor">#include &lt;alloc.h&gt;</font>
00015 <font class="preprocessor">#endif
</font>00016 <font class="preprocessor"></font><font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00017"></a><a class="code" href="class_imagemap.html#a0">00017</a> <a class="code" href="class_imagemap.html#a0">ImageMap::ImageMap</a>(<font class="keywordtype">int</font> x,<font class="keywordtype">int</font> y,<font class="keywordtype">int</font> **stamp  ):Array(5,0,5),criLines(2,0,2)
00018 <font class="comment">//</font>
00019 <font class="comment">// Contructor : should call a parser of image.seadif file .</font>
00020 <font class="comment">//</font>
00021 {
00022 
00023   rows=y;
00024   cols=x;
00025   tmpStamp=stamp;
00026 
00027   
00028   map=(<a class="code" href="class_layoutmaptype.html">layoutMapType</a>**)<a class="code" href="usrlib.h.html#a14">allocArray2</a>(cols,rows,<font class="keyword">sizeof</font>(<a class="code" href="class_layoutmaptype.html">layoutMapType</a>) );
00029 
00030 
00031 }<font class="comment">// ImageMap::ImageMap  //</font>
00032 
00033 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00034"></a><a class="code" href="class_imagemap.html#a1">00034</a>                <a class="code" href="class_imagemap.html#a1">ImageMap::~ImageMap</a>()
00035 <font class="comment">//</font>
00036 <font class="comment">//</font>
00037 {
00038 
00039   <a class="code" href="usrlib.h.html#a15">freeArray2</a>(cols,(<font class="keywordtype">void</font>**)map);
00040 
00041 }<font class="comment">// ImageMap::~ImageMap  //</font>
00042 
00043 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00044"></a><a class="code" href="class_imagemap.html#a4">00044</a>                <font class="keywordtype">int</font>   <a class="code" href="class_imagemap.html#a4">ImageMap::addFeeds</a>(<a class="code" href="class_list.html">List</a>&amp; feeds,layerType lay)
00045 <font class="comment">//</font>
00046 <font class="comment">//  Function called by yacc++ parser. It processes list of just read feeds which</font>
00047 <font class="comment">//  may be either restricted or universal .There can be also the so called</font>
00048 <font class="comment">//  external feed which when appears means that this feed has an extension</font>
00049 <font class="comment">//  to the neighbor cluster in this direction . As a flag works field net</font>
00050 <font class="comment">//  when 0 - normal feed</font>
00051 <font class="comment">//      0x1- horizontal extension</font>
00052 <font class="comment">//      0x2- vertical extension</font>
00053 <font class="comment">//</font>
00054 {
00055   <font class="keyword">static</font> <font class="keywordtype">unsigned</font>  <font class="keywordtype">int</font> actFeedFlag=1;  <font class="comment">// this variable is used to keep a</font>
00056                                        <font class="comment">// a unique identifier of a feed</font>
00057                                        <font class="comment">// which is used to recognize grid</font>
00058                                        <font class="comment">// points of the same feed marked in</font>
00059                                        <font class="comment">// actual function call.</font>
00060   <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> uniCount=0;
00061   Boolean horExt=<font class="keyword">false</font>,
00062           verExt=<font class="keyword">false</font>;
00063   <a class="code" href="class_list.html">List</a> *lPtr;
00064   
00065   <font class="keywordflow">if</font>(lay == DiffusionLayer || lay == Metal1Layer ) 
00066                                    <font class="comment">// these functions add criLines elements</font>
00067                                    <font class="comment">// too.</font>
00068     criticalIsland(feeds,lay);
00069   <font class="keywordflow">else</font>
00070   {
00071     lPtr = <font class="keyword">new</font> List();
00072     uniCount = getItemsInBox();
00073     criticalFeed(feeds);
00074   }
00075                                     <font class="comment">// we have to check also if it's</font>
00076                                     <font class="comment">// an external feed ( has an</font>
00077                                     <font class="comment">// extension to neighbor cluster</font>
00078   <font class="keywordflow">for</font>(<a class="code" href="class_listiterator.html">ListIterator</a> cIter(feeds);(<a class="code" href="class_item.html">Item</a>&amp;)cIter != NOITEM; cIter++)  
00079   {
00080     <a class="code" href="class_cripoint.html">CriPoint</a> &amp;test = (<a class="code" href="class_cripoint.html">CriPoint</a>&amp;)(<a class="code" href="class_item.html">Item</a>&amp;)cIter;
00081 
00082     <font class="keywordflow">if</font> ( test.net &amp; 0x01)     <font class="comment">// means horizontal extension</font>
00083       horExt=<font class="keyword">true</font>;
00084     <font class="keywordflow">if</font> (test.net &amp; 0x02)      <font class="comment">// means vertical extension</font>
00085       verExt=<font class="keyword">true</font>;
00086   }
00087   
00088 
00089   <font class="keywordflow">for</font>(<a class="code" href="class_listiterator.html">ListIterator</a> lIter(feeds);(<a class="code" href="class_item.html">Item</a>&amp;)lIter != NOITEM; lIter++)
00090   {
00091         <a class="code" href="class_cripoint.html">CriPoint</a> &amp;feed = (<a class="code" href="class_cripoint.html">CriPoint</a>&amp;)(<a class="code" href="class_item.html">Item</a>&amp;)lIter;
00092 
00093         <font class="keywordflow">if</font> ( feed.net == 0)     <font class="comment">// External feed flag - we have to skip it</font>
00094         {
00095     <font class="keywordtype">int</font> x=feed.x,
00096         y=feed.y;
00097     
00098     <font class="keywordflow">if</font>(x &gt; cols || y &gt; rows)
00099     {
00100       <a class="code" href="usrlib.h.html#a13">warning</a>(<font class="stringliteral">"ImageMap::addFeeds"</font>,EINPDAT);
00101       <font class="keywordflow">return</font> 1;
00102     }
00103     map[x][y].layers |=lay;
00104     map[x][y].termNo=actFeedFlag;  <font class="comment">// we use that field for feed</font>
00105                                              <font class="comment">// identifier</font>
00106     <font class="keywordflow">if</font> ( lay == PolyLayer )
00107     {
00108       map[x][y].uniNo = uniCount;
00109       lPtr-&gt;<a class="code" href="class_list.html#a3">add</a>( *<font class="keyword">new</font> Point(x,y) );
00110     }
00111     <font class="keywordflow">else</font>  <font class="comment">// we have to mark some grids in neighborhood</font>
00112     {
00113       <font class="keywordflow">if</font> (y &lt; rows-1 &amp;&amp; map[x][y+1].termNo == actFeedFlag)
00114       {
00115     map[x][y].upWay |= lay;
00116     map[x][y+1].downWay |= lay;
00117       }
00118       <font class="keywordflow">if</font> (y &gt; 0 &amp;&amp; map[x][y-1].termNo == actFeedFlag)
00119       {
00120     map[x][y].downWay |= lay;
00121     map[x][y-1].upWay |= lay;
00122       }
00123       <font class="keywordflow">if</font>(y == rows-1 &amp;&amp; verExt)  
00124       {
00125     map[x][y].upWay |= lay;
00126     map[x][0].downWay |= lay;
00127     
00128       }
00129 
00130 
00131       <font class="keywordflow">if</font> (x &lt; cols-1 &amp;&amp; map[x+1][y].termNo == actFeedFlag)
00132       {
00133     map[x][y].rightWay |= lay;
00134     map[x+1][y].leftWay |= lay;
00135       }
00136       <font class="keywordflow">if</font> (x &gt; 0 &amp;&amp; map[x-1][y].termNo == actFeedFlag)
00137       {
00138     map[x][y].leftWay |= lay;
00139     map[x-1][y].rightWay |= lay;
00140       }
00141       <font class="keywordflow">if</font>(x==cols-1 &amp;&amp; horExt)  
00142       {
00143     map[x][y].rightWay |= lay;
00144     map[0][y].leftWay |= lay;
00145       }
00146 
00147         }
00148         }
00149   }
00150 
00151   <font class="keywordflow">if</font>(lay == PolyLayer)
00152   {
00153     add( *lPtr );
00154   }
00155   
00156   actFeedFlag++;
00157   <font class="keywordflow">return</font> 0;
00158 
00159 }<font class="comment">// ImageMap::addFeeds  //</font>
00160 
00161 
00162 
00163 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00164"></a><a class="code" href="class_imagemap.html#a5">00164</a>                <font class="keywordtype">void</font> <a class="code" href="class_imagemap.html#a5">ImageMap::criticalIsland</a>(<a class="code" href="class_list.html">List</a>&amp; feeds,layerType layer)
00165 <font class="comment">//</font>
00166 <font class="comment">// This function returns 0 if this feed doesn't lay under one of mirror</font>
00167 <font class="comment">// axis , otherwise number assigned to this critical area and adds all</font>
00168 <font class="comment">// points laying under mirror line to "criLines"</font>
00169 {
00170   <a class="code" href="class_list.html">List</a> *newList = <font class="keyword">new</font> List();
00171   Boolean added = <font class="keyword">false</font>;
00172   <a class="code" href="class_listiterator.html">ListIterator</a>  lIter(feeds);
00173 
00174   <font class="keywordflow">for</font>(;(<a class="code" href="class_item.html">Item</a>&amp;)lIter != NOITEM;lIter++)
00175   {
00176     <a class="code" href="class_cripoint.html">CriPoint</a> &amp;prev = (<a class="code" href="class_cripoint.html">CriPoint</a>&amp;)(<a class="code" href="class_item.html">Item</a>&amp;)lIter;
00177     <a class="code" href="class_cripoint.html">CriPoint</a> p(prev);
00178 
00179     <font class="keywordflow">if</font>(p.net &gt; 0)     <font class="comment">// skip external feed flags</font>
00180       <font class="keywordflow">continue</font>;
00181 
00182     <font class="keywordflow">if</font>(tmpStamp[p.x&lt;&lt;1][p.y&lt;&lt;1] &gt; 0)     <font class="comment">// mirror axis </font>
00183     {
00184       added=<font class="keyword">true</font>;
00185                                          <font class="comment">// now recognizing neighbors</font>
00186       clusterMapType nb=recognizeNeighbors(p.x,p.y);
00187 
00188       newList-&gt;<a class="code" href="class_list.html#a3">add</a> ( *<font class="keyword">new</font> CriCandidate(p.x,p.y,layer,0,nb) );
00189     }
00190   }
00191 
00192   <font class="keywordflow">if</font> (added)
00193   {
00194     criLines.add(* newList);
00195   }
00196   <font class="keywordflow">else</font>
00197   {
00198     <font class="keyword">delete</font> newList;
00199   }
00200 }<font class="comment">// ImageMap::criticalIsland  //</font>
00201 
00202 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00203"></a><a class="code" href="class_imagemap.html#a6">00203</a>                <font class="keywordtype">void</font> <a class="code" href="class_imagemap.html#a6">ImageMap::criticalFeed</a>(<a class="code" href="class_list.html">List</a>&amp; feeds)
00204 <font class="comment">//</font>
00205 <font class="comment">//  Does the same job as criticalIsland but for universal feeds. </font>
00206 <font class="comment">//  This feed is critical if at least one of the points belongs to</font>
00207 <font class="comment">//  another sector than others or lies on mirror axis.</font>
00208 <font class="comment">//  Returns number of critical line or 0</font>
00209 <font class="comment">//  if this feed is not critical.</font>
00210 {
00211   <font class="keyword">static</font> Boolean  warningFlag=<font class="keyword">false</font>;
00212   <a class="code" href="class_listiterator.html">ListIterator</a>  lIter(feeds);
00213   <font class="keywordtype">int</font> secNo = -1;
00214   
00215   <font class="keywordflow">for</font>(;(<a class="code" href="class_item.html">Item</a>&amp;)lIter != NOITEM;lIter++)
00216   {
00217     <a class="code" href="class_cripoint.html">CriPoint</a> &amp;prev = (<a class="code" href="class_cripoint.html">CriPoint</a>&amp;)(<a class="code" href="class_item.html">Item</a>&amp;)lIter;
00218     <a class="code" href="class_cripoint.html">CriPoint</a> p(prev);
00219     
00220     <font class="keywordflow">if</font> (p.net &gt; 0)
00221     {
00222       <font class="keywordflow">if</font>(!warningFlag)
00223       {
00224     cerr &lt;&lt; <font class="stringliteral">"\nWarning : Universal feeds extending to neighbor basic cells"</font>;
00225     cerr &lt;&lt; <font class="stringliteral">"\n won't be checked for existance of net conflicts !!! \n"</font>;
00226     warningFlag=<font class="keyword">true</font>;
00227       }
00228     }
00229     <font class="keywordflow">else</font>
00230     {
00231       <font class="keywordtype">int</font> thisSec = -tmpStamp[p.x&lt;&lt;1][p.y&lt;&lt;1];
00232       
00233       <font class="keywordflow">if</font>( tmpStamp[p.x&lt;&lt;1][p.y&lt;&lt;1] &gt; 0 || (secNo != -1 &amp;&amp; thisSec != secNo) )  
00234       {
00235     <a class="code" href="class_list.html">List</a> *newList= <font class="keyword">new</font> List();
00236     lIter.<a class="code" href="class_listiterator.html#a6">restart</a>();
00237     <font class="comment">// first we have to build a temporary</font>
00238     <font class="comment">// pattern needed during critical points</font>
00239     <font class="comment">// recognition</font>
00240     
00241     clusterMapType pat=0x0;
00242     <font class="keywordflow">for</font>(;(<a class="code" href="class_item.html">Item</a>&amp;)lIter != NOITEM;lIter++)
00243     {
00244       p = (<a class="code" href="class_cripoint.html">CriPoint</a>&amp;)(<a class="code" href="class_item.html">Item</a>&amp;)lIter;
00245       clusterMapType cm;
00246       <font class="keywordflow">if</font>( (cm=tmpStamp[p.x&lt;&lt;1][p.y&lt;&lt;1])&gt;0)
00247         pat |= recognizeNeighbors(p.x,p.y);
00248       <font class="keywordflow">else</font>
00249         pat |= 0x01 &lt;&lt; (-1-cm); 
00250       <font class="comment">// marking these sectors</font>
00251     }
00252     lIter.<a class="code" href="class_listiterator.html#a6">restart</a>();
00253     
00254     <font class="keywordflow">for</font>(;(<a class="code" href="class_item.html">Item</a>&amp;)lIter != NOITEM;lIter++)
00255     {
00256       <a class="code" href="class_cripoint.html">CriPoint</a> &amp;tmp=(<a class="code" href="class_cripoint.html">CriPoint</a>&amp;)(<a class="code" href="class_item.html">Item</a>&amp;)lIter;
00257       p = tmp;
00258       
00259       newList-&gt;<a class="code" href="class_list.html#a3">add</a> (* <font class="keyword">new</font> CriCandidate(p.x,p.y,PolyLayer,0,pat) );
00260     }
00261     criLines.add(*newList);
00262     <font class="keywordflow">return</font>;
00263       }
00264       <font class="keywordflow">else</font>
00265     secNo=thisSec;
00266     }
00267   }
00268   
00269 
00270 }<font class="comment">// ImageMap::criticalFeed  //</font>
00271 
00272 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00273"></a><a class="code" href="class_imagemap.html#a7">00273</a>                <font class="keywordtype">void</font>  <a class="code" href="class_imagemap.html#a7">ImageMap::clearFeedNo</a>( <font class="keywordtype">void</font>  )
00274 <font class="comment">//</font>
00275 <font class="comment">//</font>
00276 {
00277   <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i=0;i&lt;cols;i++)
00278   {
00279     <a class="code" href="class_layoutmaptype.html">layoutMapType</a> *lPtr=map[i];
00280     
00281     <font class="keywordflow">for</font>(<font class="keywordtype">int</font> j=0;j&lt;rows;j++,lPtr++)
00282     {
00283       lPtr-&gt;termNo=0;
00284     }
00285   }
00286 }<font class="comment">// ImageMap::clearFeedNo  //</font>
00287 
00288 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00289"></a><a class="code" href="class_imagemap.html#a8">00289</a>                clusterMapType <a class="code" href="class_imagemap.html#a8">ImageMap::recognizeNeighbors</a>(<font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y)
00290 <font class="comment">//</font>
00291 <font class="comment">//  return variable of type clusterMapType with set neighbor sectors bits</font>
00292 {
00293 
00294   clusterMapType nb=0x0;
00295   <font class="keywordtype">int</font> m1=x&lt;&lt;1,m2=y&lt;&lt;1;
00296   clusterMapType cm;
00297   <font class="keywordtype">int</font> maxX=2*cols-1,
00298       maxY=2*rows-1;
00299     <font class="keywordtype">int</font> i,j;
00300 
00301     <font class="keywordflow">for</font>(i=m1-1;i&lt;=m1+1;i++)
00302         <font class="keywordflow">for</font>(j=m2-1;j&lt;=m2+1;j++)
00303     {
00304       <font class="keywordflow">if</font> ( i&gt;=0 &amp;&amp; i&lt;maxX &amp;&amp; j&gt;=0 &amp;&amp; j&lt;maxY &amp;&amp; 
00305       i!= m1 &amp;&amp; j!=m2 &amp;&amp; (cm=tmpStamp[i][j]) &lt; 0)  
00306     <font class="comment">// means- there's a sector</font>
00307     nb |= 0x01 &lt;&lt; (-1-cm);  
00308     }
00309   <font class="keywordtype">int</font> highCount=0;
00310   clusterMapType test=nb;
00311 
00312   <font class="keywordflow">for</font>(<font class="keywordtype">int</font> a=0;a&lt; <font class="keyword">sizeof</font>(clusterMapType)*8;a++,test = test &gt;&gt; 1)
00313     <font class="keywordflow">if</font> (test &amp; 0x01)
00314       highCount++; 
00315   <font class="keywordflow">if</font> (highCount &lt; 2)
00316     <font class="keywordflow">return</font> 0;           <font class="comment">// that's 'cos 0 means leave this point</font>
00317   <font class="keywordflow">else</font>
00318     <font class="keywordflow">return</font> nb;
00319 
00320 }<font class="comment">// ImageMap::recognizeNeighbors  //</font>
</div></pre><hr><address><small>Generated at Thu Sep 28 15:37:57 2000 for madonna by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align=center border=0 
width=110 height=53></a>1.1.5 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy; 1997-2000</small></address>
</body>
</html>
