<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<title>layMap.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.1.5 on Thu Sep 28 15:37:58 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>layMap.C</h1><a href="layMap.C.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">// ********************************************************</font>
00002 <font class="comment">// *  LAYMAP.C                                            *</font>
00003 <font class="comment">// *                                                      *</font>
00004 <font class="comment">// *  Author : Ireneusz Karkowski 1991                    *</font>
00005 <font class="comment">// *    @(#)layMap.C 1.10 05/05/94 Delft University of Technology </font>
00006 <font class="comment">// ********************************************************</font>
00007 
00008 <font class="preprocessor">#include &lt;stream.h&gt;</font>
00009 <font class="preprocessor">#include "<a class="code" href="cricand.h.html">cricand.h</a>"</font>
00010 <font class="preprocessor">#include "<a class="code" href="layMap.h.html">layMap.h</a>"</font>
00011 <font class="preprocessor">#include "<a class="code" href="clst.h.html">clst.h</a>"</font>
00012 <font class="preprocessor">#include &lt;string.h&gt;</font>
00013 
00014 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00015"></a><a class="code" href="class_laymap.html#a0">00015</a>    <a class="code" href="class_laymap.html#a0">LayMap::LayMap</a>(LAYOUT *l,<a class="code" href="class_imagemap.html">ImageMap</a> *i,<a class="code" href="class_array.html">Array</a> *n):
00016                     layout(l),imageMap(i),freeNets(n)
00017 <font class="comment">//</font>
00018 <font class="comment">// Constructor</font>
00019 {
00020   initFlag=<font class="keyword">false</font>;
00021   actualMatrix=NULL;   <font class="comment">// to ensure that no wires in "map"</font>
00022   map=NULL;
00023 
00024 }<font class="comment">// LayMap::LayMap  //</font>
00025 
00026 
00027 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00028"></a><a class="code" href="class_laymap.html#a1">00028</a>                <a class="code" href="class_laymap.html#a1">LayMap::~LayMap</a>()
00029 <font class="comment">//</font>
00030 <font class="comment">//</font>
00031 {
00032   <font class="keywordflow">if</font>(initFlag)
00033   {
00034     <a class="code" href="usrlib.h.html#a15">freeArray2</a>(xMax-xMin+2,(<font class="keywordtype">void</font>**)map);
00035   }
00036 
00037 }<font class="comment">// LayMap::~LayMap  //</font>
00038 
00039 
00040 
00041 <font class="comment">/*
</font>00042 <font class="comment">
</font>00043 <font class="comment">//----------------------------------------------------------------------------
</font>00044 <font class="comment">             layerType  LayMap::viaToCriticalArea(int x,int y)
</font>00045 <font class="comment">//
</font>00046 <font class="comment">// Returns layer if there's a critical area under this point or value
</font>00047 <font class="comment">// NoneLayer otherwise.Coord. should be inside cluster
</font>00048 <font class="comment">{
</font>00049 <font class="comment">  layoutMapType *grid = &amp;(imageMap-&gt;map[x][y]);
</font>00050 <font class="comment">
</font>00051 <font class="comment">  if ( grid-&gt;criAreaNo  ) 
</font>00052 <font class="comment">                                 // critical area may be only of Diffusion
</font>00053 <font class="comment">                                 // or Poly layer type so via between metals
</font>00054 <font class="comment">                                 // doesn't mean any danger to us.
</font>00055 <font class="comment">    return layerType(grid-&gt;layers &amp; (DiffusionLayer | PolyLayer));
</font>00056 <font class="comment">  return NoneLayer;
</font>00057 <font class="comment">
</font>00058 <font class="comment">}// LayMap::viaToCriticalArea  //
</font>00059 <font class="comment">*/</font>
00060 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00061"></a><a class="code" href="class_laymap.html#a3">00061</a> <font class="keywordtype">unsigned</font>  <font class="keywordtype">int</font>   <a class="code" href="class_laymap.html#a3">LayMap::findNetId</a>(<font class="keywordtype">int</font> x,<font class="keywordtype">int</font> y,layerType layer,<font class="keywordtype">short</font> *mtx)
00062 <font class="comment">//</font>
00063 <font class="comment">//  Performs search for external terminal point connected with this point.</font>
00064 <font class="comment">//  If it is a first call creates layout map, otherwise only refreshes old</font>
00065 <font class="comment">//  one. Returns terminal id or 1 (what means constrained critical net) if</font>
00066 <font class="comment">//  this point belongs to one of the internal nets. </font>
00067 <font class="comment">//  All this stuff below here is becouse I wanted to avoid useless operations.</font>
00068 <font class="comment">//  For example it can happen that there's no critical area at all and then</font>
00069 <font class="comment">//  to all all that job is unnessesery.</font>
00070 <font class="comment">//  Very important is here that mtx pointer should really point to another</font>
00071 <font class="comment">//  matrix when we want to start considering another transposition of our</font>
00072 <font class="comment">//  layout.</font>
00073 {
00074   <font class="keywordflow">if</font>(!initFlag )
00075   {
00076     create();
00077     recognizeTerminals();
00078     addWires(0,0,layout,mtx);
00079     addTerms(mtx);
00080     initFlag=<font class="keyword">true</font>;
00081     actualMatrix=mtx;
00082   }
00083   <font class="keywordflow">else</font>
00084   {
00085     <font class="keywordflow">if</font>(actualMatrix == mtx)
00086       clearFlags();
00087     <font class="keywordflow">else</font>
00088     {
00089       <a class="code" href="usrlib.h.html#a15">freeArray2</a>(xMax-xMin+2,(<font class="keywordtype">void</font>**)map);
00090       actualMatrix=mtx;
00091       create();
00092       addWires(0,0,layout,mtx);
00093       addTerms(mtx);
00094     }  
00095   }
00096   <font class="keywordflow">if</font> ( x &gt;= xMin &amp;&amp; x &lt;= xMax &amp;&amp; y &gt;= yMin &amp;&amp; y &lt;=yMax)
00097     <font class="keywordflow">return</font> search(x,y,layer);
00098   <font class="keywordflow">else</font>
00099     <font class="keywordflow">return</font> 0;
00100 
00101 }<font class="comment">// LayMap::findNetId  //</font>
00102 
00103 
00104 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00105"></a><a class="code" href="class_laymap.html#a4">00105</a>   <font class="keywordtype">void</font>  <a class="code" href="class_laymap.html#a4">LayMap::addCriticalPoints</a>(<a class="code" href="class_clst.html">Clst</a> &amp;c,<font class="keywordtype">short</font> *mtx)
00106 <font class="comment">//</font>
00107 <font class="comment">// adds points belonging to critical area and laying under mirror axis</font>
00108 <font class="comment">// if it's really  critical </font>
00109 {
00110   <font class="keywordtype">int</font> ver=imageMap-&gt;rows,
00111       hor=imageMap-&gt;cols;
00112   <a class="code" href="class_list.html">List</a>&amp; list=c.criticalPoints;
00113   <font class="keywordtype">int</font> x=c.cX,y=c.cY;
00114 
00115   <a class="code" href="class_arrayiterator.html">ArrayIterator</a> aIter(imageMap-&gt;criLines);
00116   
00117   <font class="keywordflow">for</font>(;(<a class="code" href="class_item.html">Item</a>&amp;)aIter != NOITEM;aIter++)
00118   {
00119     <a class="code" href="class_list.html">List</a> &amp;criLine = (<a class="code" href="class_list.html">List</a>&amp;)(<a class="code" href="class_item.html">Item</a>&amp;)aIter;
00120 
00121     <a class="code" href="class_listiterator.html">ListIterator</a> criIter(criLine);
00122     
00123     <font class="keywordflow">for</font>(;(<a class="code" href="class_item.html">Item</a>&amp;)criIter != NOITEM;criIter++)
00124     {
00125       <a class="code" href="class_cricandidate.html">CriCandidate</a> &amp;cp = (<a class="code" href="class_cricandidate.html">CriCandidate</a>&amp;)(<a class="code" href="class_item.html">Item</a>&amp;)criIter;
00126       
00127       <font class="keywordflow">if</font> (cp.neighbors == 0 || (cp.neighbors &amp; c.pattern)!= cp.neighbors)
00128       {
00129     <font class="comment">// we don't have to check points laying</font>
00130     <font class="comment">// on mirror axis between two sectors</font>
00131     <font class="comment">// taken by this cell or belonging</font>
00132     <font class="comment">// to critical universal feeds laying</font>
00133     <font class="comment">// inside this cell</font>
00134     <font class="comment">// cp.neighbors in this place contains set of</font>
00135     <font class="comment">// bits on positions of sectors on</font>
00136     <font class="comment">// both sides of axis for restricted feed</font>
00137     <font class="comment">// or sectors to which belong critical</font>
00138     <font class="comment">// universal feed</font>
00139     
00140     <font class="keywordtype">int</font> net=findNetId(x*hor+cp.x,y*ver+cp.y,<a class="code" href="phil.h.html#a25">layerType</a>(cp.layer),mtx);
00141     
00142     <font class="keywordflow">if</font> (net != 0)                    <font class="comment">// this point is connected</font>
00143                                          <font class="comment">// to one of terminals</font>
00144     {
00145       <a class="code" href="class_cripoint.html">CriPoint</a> &amp;newCp = * <font class="keyword">new</font> CriPoint(cp.x,cp.y,<a class="code" href="phil.h.html#a25">layerType</a>(cp.layer),net);
00146       <font class="keywordflow">if</font> ( ! list.<a class="code" href="class_package.html#a4">hasItem</a>( newCp) )
00147         list.<a class="code" href="class_list.html#a3">add</a>( newCp );
00148       <font class="keywordflow">else</font>
00149         <font class="keyword">delete</font> (<font class="keywordtype">void</font>*)&amp;newCp;
00150     } 
00151       }      
00152     }
00153     
00154   }
00155 
00156 }<font class="comment">// LayMap::addCriticalPoints  //</font>
00157 
00158 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00159"></a><a class="code" href="class_laymap.html#c0">00159</a>                <font class="keywordtype">unsigned</font>  <font class="keywordtype">int</font> <a class="code" href="class_laymap.html#c0">LayMap::search</a>(<font class="keywordtype">int</font> x,<font class="keywordtype">int</font> y,layerType layer)
00160 <font class="comment">//</font>
00161 <font class="comment">// Method  of searching is very simple : this function is called recursively</font>
00162 <font class="comment">// for all still not visited points in the vicinity of (x,y),or other points</font>
00163 <font class="comment">// in universal feed or tries to change layer if there's a via. If all these</font>
00164 <font class="comment">// possibilities are already checked it returns 0.</font>
00165 {
00166   <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> net;
00167   <a class="code" href="class_layoutmaptype.html">layoutMapType</a> *m=&amp;map[x-xMin][y-yMin];
00168 
00169   <font class="keywordflow">if</font> (m-&gt;visited &amp; layer)          <font class="comment">// we've already been here !</font>
00170     <font class="keywordflow">return</font> 0;            
00171 
00172   <font class="keywordflow">if</font> ( m-&gt;termNo )
00173     <font class="keywordflow">switch</font> (layer)
00174     {
00175     <font class="keywordflow">case</font> DiffusionLayer:
00176     <font class="keywordflow">case</font> PolyLayer:
00177                   <font class="keywordflow">if</font> (!(m-&gt;layers &amp; Metal1Layer)&amp;&amp; !(m-&gt;layers &amp; Metal2Layer))
00178             <font class="keywordflow">return</font> m-&gt;termNo;
00179           <font class="keywordflow">break</font>;
00180     <font class="keywordflow">case</font> Metal1Layer:
00181                   <font class="keywordflow">if</font> (!(m-&gt;layers &amp; Metal2Layer))
00182             <font class="keywordflow">return</font> m-&gt;termNo;
00183           <font class="keywordflow">break</font>;
00184     <font class="keywordflow">case</font> Metal2Layer:
00185           <font class="keywordflow">return</font> m-&gt;termNo;
00186     }
00187 
00188 
00189   m-&gt;visited |= layer;               <font class="comment">// mark that place</font>
00190   
00191 
00192   <font class="comment">// visiting points belonging to the same layer :</font>
00193 
00194 
00195 
00196   <font class="keywordflow">if</font>(layer != PolyLayer)             <font class="comment">// restricted feeds &amp;&amp; metal segments</font>
00197   {
00198                                      <font class="comment">// we have only to check this neighbors</font>
00199                                      <font class="comment">// which have connection with our on</font>
00200                                      <font class="comment">// the same layer</font>
00201     <font class="keywordflow">if</font>(m-&gt;leftWay &amp; layer &amp;&amp; x &gt; xMin)
00202       <font class="keywordflow">if</font> ( net = search(x-1,y,layer) )
00203     <font class="keywordflow">return</font> net;
00204     <font class="keywordflow">if</font>(m-&gt;upWay &amp; layer &amp;&amp; y &lt; yMax)
00205       <font class="keywordflow">if</font> ( net = search(x,y+1,layer) )
00206     <font class="keywordflow">return</font> net;
00207     <font class="keywordflow">if</font>(m-&gt;rightWay &amp; layer &amp;&amp; x &lt; xMax)
00208       <font class="keywordflow">if</font> ( net = search(x+1,y,layer) )
00209     <font class="keywordflow">return</font> net;
00210     <font class="keywordflow">if</font>(m-&gt;downWay &amp; layer &amp;&amp; y &gt; yMin)
00211       <font class="keywordflow">if</font> ( net = search(x,y-1,layer) )
00212     <font class="keywordflow">return</font> net;
00213     
00214   }
00215   <font class="keywordflow">else</font>                                <font class="comment">// for universal feed we have to</font>
00216                                       <font class="comment">// go to visit all of the points from the </font>
00217                                       <font class="comment">// list</font>
00218   {
00219 
00220     <a class="code" href="class_listiterator.html">ListIterator</a> rIter(  (<a class="code" href="class_list.html">List</a>&amp;)(*imageMap)[m-&gt;uniNo] );
00221     <font class="keywordtype">int</font> a = x / imageMap-&gt;cols ,
00222         b = y / imageMap-&gt;rows;
00223     
00224     <font class="keywordflow">if</font> (x&lt;0)
00225       a--;
00226     <font class="keywordflow">if</font> (y&lt;0)
00227       b--;
00228 
00229     a*=imageMap-&gt;cols;
00230     b*=imageMap-&gt;rows;
00231                           <font class="comment">// now we have coordinates of left-bottom point</font>
00232                           <font class="comment">// in cluster</font>
00233 
00234     <font class="keywordflow">for</font>(;(<a class="code" href="class_item.html">Item</a>&amp;)rIter != NOITEM;rIter++)
00235     {
00236       <a class="code" href="class_point.html">Point</a> &amp;p = (<a class="code" href="class_point.html">Point</a>&amp;)(<a class="code" href="class_item.html">Item</a>&amp;)rIter;
00237       <font class="keywordflow">if</font> ( (x!= a+p.x || y!= b+p.y) &amp;&amp; (net = search(a+p.x,b+p.y,layer))&gt;0 )
00238     <font class="keywordflow">return</font> net;
00239     }
00240   }
00241 
00242 
00243   <font class="comment">// if all points on this layer visited lets try go to the other</font>
00244 
00245 
00246   <font class="keywordflow">if</font>(m-&gt;layers &amp; ViaLayer)          <font class="comment">// normal via exists </font>
00247     <font class="keywordflow">if</font> ( (layer &amp; Metal1Layer) || (layer &amp; Metal2Layer) )
00248     {
00249       <font class="keywordflow">if</font>( net = search(x,y,(m-&gt;layers &amp; PolyLayer)&gt;0 ? PolyLayer : DiffusionLayer))
00250     <font class="keywordflow">return</font> net;
00251     }
00252     <font class="keywordflow">else</font>
00253     {
00254       <font class="keywordflow">if</font>( net = search(x,y,(m-&gt;layers &amp; Metal1Layer) ? Metal1Layer : Metal2Layer))
00255     <font class="keywordflow">return</font> net;
00256     }
00257 
00258   <font class="keywordflow">if</font>((m-&gt;layers  &amp; MetalsViaLayer)&gt;0)   <font class="comment">// via between two metals</font>
00259     <font class="keywordflow">if</font> ( (layer &amp; Metal1Layer)&gt;0  )
00260     {  
00261       <font class="keywordflow">if</font>( net = search(x,y,Metal2Layer))
00262     <font class="keywordflow">return</font> net;
00263     }
00264     <font class="keywordflow">else</font>
00265     {
00266       <font class="keywordflow">if</font>( net = search(x,y,Metal1Layer))
00267     <font class="keywordflow">return</font> net;
00268     }  
00269 
00270   
00271 
00272   <font class="comment">// we cannot go further - must return</font>
00273 
00274   <font class="keywordflow">return</font> 0;
00275 
00276 }<font class="comment">// LayMap::search  //</font>
00277 
00278 
00279 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00280"></a><a class="code" href="class_laymap.html#c1">00280</a>                <font class="keywordtype">void</font>  <a class="code" href="class_laymap.html#c1">LayMap::create</a>()
00281 <font class="comment">//</font>
00282 <font class="comment">// Creates true layout map for layout pointed by "layout" </font>
00283 <font class="comment">// It's implemented as an array of side 3x bonding box of layout. Each grid</font>
00284 <font class="comment">// point is modeled as record of layoutMapType type. </font>
00285 {
00286   <font class="keywordtype">int</font> bHigh = layout-&gt;bbx[VER],
00287       bWidth = layout-&gt;bbx[HOR],
00288       iHigh = imageMap-&gt;rows,
00289       iWidth = imageMap-&gt;cols;
00290 
00291   <font class="keywordflow">if</font>(bHigh &lt; iHigh)
00292     bHigh=iHigh;
00293 
00294   <font class="keywordflow">if</font>(bWidth &lt; iWidth)
00295     bWidth=iWidth;
00296 
00297 
00298   xMin=-bWidth;
00299   xMax=2*bWidth-1;
00300   yMin=-bHigh;
00301   yMax=2*bHigh-1;
00302 
00303 
00304   map=(<a class="code" href="class_layoutmaptype.html">layoutMapType</a>**)<a class="code" href="usrlib.h.html#a14">allocArray2</a>(xMax-xMin+2,yMax-yMin+2, <font class="keyword">sizeof</font>(<a class="code" href="class_layoutmaptype.html">layoutMapType</a>));
00305   
00306   <font class="comment">// now we have to fill it out</font>
00307 
00308   <a class="code" href="class_layoutmaptype.html">layoutMapType</a> *sPtr,*dPtr;
00309   
00310   <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i=xMin;i&lt;=xMax;i++)  <font class="comment">// for all columns</font>
00311   {
00312     <font class="keywordtype">int</font>  x = i % iWidth;
00313     <font class="keywordtype">int</font>  y = yMin % iHigh;
00314 
00315     <font class="keywordflow">if</font>(y &lt; 0)
00316       y+=iHigh;
00317 
00318     <font class="keywordflow">if</font> ( x &lt; 0) 
00319       x+=iWidth;              <font class="comment">// x,y - coordinates inside cluster</font>
00320 
00321                      
00322     dPtr = &amp;map[i+bWidth][0];     <font class="comment">// destination column pointer</font>
00323     
00324     sPtr = &amp; imageMap-&gt;map[x][y];
00325 
00326     <font class="keywordtype">int</font> j = yMin;             <font class="comment">// i,j - coordinates inside new array</font>
00327     <font class="keywordtype">int</font> numToCopy = iHigh - y;
00328     
00329     <font class="keywordflow">while</font>( j&lt;= yMax )
00330     {
00331       memcpy(dPtr,sPtr,numToCopy* <font class="keyword">sizeof</font>(<a class="code" href="class_layoutmaptype.html">layoutMapType</a>));
00332       
00333       sPtr=&amp;imageMap-&gt;map[x][0];
00334       dPtr+=numToCopy;
00335       j+=numToCopy;
00336 
00337       <font class="keywordflow">if</font>( yMax - j &gt; iHigh)  <font class="comment">// if last time</font>
00338     numToCopy=iHigh;
00339       <font class="keywordflow">else</font>
00340     numToCopy=yMax+1-j;
00341     }
00342   }
00343 
00344 }<font class="comment">// LayMap::create  //</font>
00345 
00346 
00347 
00348 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00349"></a><a class="code" href="class_laymap.html#c2">00349</a> <font class="keywordtype">void</font>  <a class="code" href="class_laymap.html#c2">LayMap::addWires</a>(<font class="keywordtype">int</font> xoffs,<font class="keywordtype">int</font> yoffs,LAYOUT *lPtr,<font class="keywordtype">short</font> *matrix)
00350 <font class="comment">//</font>
00351 <font class="comment">// adds to image metal layers in places where they will be after apllying </font>
00352 <font class="comment">// matrix matrix.</font>
00353 {
00354 
00355   <font class="keywordflow">for</font>(SLICE *slPtr = lPtr-&gt;slice;slPtr != NULL;slPtr=slPtr-&gt;next)
00356     goDeeper(slPtr,lPtr,matrix); 
00357 
00358   <font class="keywordflow">for</font>(WIRE *wPtr=lPtr-&gt;wire;wPtr!= NULL;wPtr=wPtr-&gt;next)
00359   {
00360     <font class="keywordtype">short</font>  out[4];                   <font class="comment">// wire after transformation</font>
00361     layerType layer;
00362     <font class="keywordtype">int</font>  xBegin,
00363          xEnd,
00364          yBegin,
00365          yEnd;
00366 
00367     <a class="code" href="mtx.C.html#a5">mtxapplytocrd</a>(out,wPtr-&gt;crd,matrix);
00368 
00369     layer=<a class="code" href="phil.h.html#a15">recognizeLayer</a>(wPtr-&gt;layer);
00370 
00371 
00372     <font class="keywordflow">if</font> (out[XL] &lt;= out[XR])           <font class="comment">// after transformation relation between</font>
00373     {                                 <font class="comment">// points may change</font>
00374       xBegin=out[XL]-xMin;
00375       xEnd=out[XR]-xMin;
00376     }  
00377     <font class="keywordflow">else</font>
00378     {
00379       xBegin=out[XR]-xMin;
00380       xEnd=out[XL]-xMin;
00381     }
00382     <font class="keywordflow">if</font> (out[YB] &lt;= out[YT])    
00383     {                          
00384       yBegin=out[YB]-yMin;
00385       yEnd=out[YT]-yMin;
00386     }  
00387     <font class="keywordflow">else</font>
00388     {
00389       yBegin=out[YT]-yMin;
00390       yEnd=out[YB]-yMin;
00391     }
00392                 <font class="comment">// layout instances may be shifted</font>
00393     yBegin+=yoffs;
00394     yEnd+=yoffs;
00395     xBegin+=xoffs;
00396     xEnd+=xoffs;
00397 
00398     <font class="keywordflow">if</font> (xBegin &lt; 0 || yBegin &lt; 0 || yEnd &gt; yMax-yMin || xEnd &gt; xMax-xMin )
00399     {
00400       <font class="comment">// cerr &lt;&lt; "\n  Wrong wire segment - coordinates out of range !\n";</font>
00401        <font class="comment">// users really tend to get upset if you do not tell \'m WHERE the cause</font>
00402        <font class="comment">// of their problem is. So why not print the NAME OF THE LAYOUT that we</font>
00403        <font class="comment">// are complaining about?</font>
00404        cerr &lt;&lt; form(<font class="stringliteral">"\n Layout %s(%s(%s(%s))), Wire [%d %d %d %d %d] "</font>
00405             <font class="stringliteral">"coordinates out of range\n"</font>,
00406             lPtr-&gt;name, lPtr-&gt;circuit-&gt;name, lPtr-&gt;circuit-&gt;function-&gt;name,
00407             lPtr-&gt;circuit-&gt;function-&gt;library-&gt;name, wPtr-&gt;layer,
00408             wPtr-&gt;crd[XL], wPtr-&gt;crd[XR], wPtr-&gt;crd[YB], wPtr-&gt;crd[YT]);
00409       <a class="code" href="usrlib.h.html#a12">usrErr</a>(<font class="stringliteral">"LayMap::addWires"</font>,EINPDAT);
00410     }
00411         <font class="keywordtype">int</font> x,y;
00412 
00413         <font class="keywordflow">for</font>(x=xBegin;x&lt;=xEnd;x++)
00414             <font class="keywordflow">for</font>(y=yBegin;y&lt;=yEnd;y++)
00415       { 
00416 
00417     <a class="code" href="class_layoutmaptype.html">layoutMapType</a> *m= &amp;map[x][y];
00418     m-&gt;layers |= layer;
00419     
00420     <font class="keywordflow">if</font>(y &lt; yEnd)               <font class="comment">// mark connections between grid points</font>
00421       m-&gt;upWay |= layer;
00422     <font class="keywordflow">if</font>(y &gt; yBegin)
00423       m-&gt;downWay |= layer;
00424     <font class="keywordflow">if</font>(x &lt; xEnd)
00425       m-&gt;rightWay |= layer;
00426     <font class="keywordflow">if</font>(x &gt; xBegin)
00427       m-&gt;leftWay |= layer;
00428       }
00429   }
00430 
00431 }<font class="comment">// LayMap::addWires  //</font>
00432 
00433 
00434 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00435"></a><a class="code" href="class_laymap.html#c3">00435</a>         <font class="keywordtype">void</font>  <a class="code" href="class_laymap.html#c3">LayMap::goDeeper</a>(SLICE *slice,LAYOUT *lPtr,<font class="keywordtype">short</font> *matrix)
00436 <font class="comment">//</font>
00437 <font class="comment">//</font>
00438 {
00439   <font class="keywordflow">if</font>(slice-&gt;chld_type == SLICE_CHLD)
00440   {
00441     <font class="keywordflow">for</font>(SLICE *cslPtr=slice-&gt;chld.slice;cslPtr != NULL;cslPtr=cslPtr-&gt;next)
00442       goDeeper(cslPtr,lPtr,matrix);
00443   }
00444   <font class="keywordflow">else</font>
00445   { 
00446     <font class="keywordflow">for</font>(LAYINST *liPtr=slice-&gt;chld.layinst;liPtr!=NULL;liPtr=liPtr-&gt;next)
00447       <font class="keywordflow">if</font>(strstr(liPtr-&gt;layout-&gt;name,"Tmp_Cell_")==NULL ) <font class="comment">// don't consider </font>
00448                                                      <font class="comment">// nelsis's tmp cells</font>
00449       {
00450      <font class="keywordtype">short</font> out[6],
00451           *mtxb=liPtr-&gt;mtx;
00452                 <font class="comment">// transformation for this cell is a multiplication</font>
00453                 <font class="comment">// of transfomation of parrent and transformation</font>
00454                 <font class="comment">// of child within parrent</font>
00455     
00456     out[A11] = matrix[A11]*mtxb[A11] + matrix[A12]*mtxb[A21];
00457     out[A12] = matrix[A11]*mtxb[A12] + matrix[A12]*mtxb[A22];
00458     out[A21] = matrix[A21]*mtxb[A11] + matrix[A22]*mtxb[A21];
00459     out[A22] = matrix[A21]*mtxb[A12] + matrix[A22]*mtxb[A22];
00460     out[B1]  = matrix[A11]*mtxb[B1]  + matrix[A12]*mtxb[B2] + matrix[B1];
00461     out[B2]  = matrix[A21]*mtxb[B1]  + matrix[A22]*mtxb[B2] + matrix[B2];
00462 
00463 
00464     addWires(0,0,liPtr-&gt;layout,out);    
00465 
00466     <font class="comment">// addWires(liPtr-&gt;mtx[B1],liPtr-&gt;mtx[B2],liPtr-&gt;layout,matrix);</font>
00467       }
00468 
00469 
00470       <font class="keywordflow">else</font>
00471       {
00472     cerr &lt;&lt; <font class="stringliteral">"\n Layouts cannot be build of nelsis's temporary cells\n"</font>;
00473     <a class="code" href="usrlib.h.html#a12">usrErr</a>(<font class="stringliteral">"LayMap::goDeeper"</font>,EINPDAT);
00474       }
00475 
00476   }
00477 
00478 }<font class="comment">// LayMap::goDeeper  //</font>
00479 
00480 
00481 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00482"></a><a class="code" href="class_laymap.html#c4">00482</a>                <font class="keywordtype">void</font>  <a class="code" href="class_laymap.html#c4">LayMap::refresh</a>()
00483 <font class="comment">//</font>
00484 <font class="comment">//  Clears metal layers,terminals and flag fields.</font>
00485 {
00486   <font class="keywordtype">int</font> toClear = Metal1Layer | Metal2Layer | MetalsViaLayer | ViaLayer;
00487   toClear = ~toClear;
00488 
00489   <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i=0;i&lt;=xMax-xMin;i++)
00490   {
00491     <a class="code" href="class_layoutmaptype.html">layoutMapType</a> *lPtr = map[i];
00492     <font class="keywordflow">for</font>(<font class="keywordtype">int</font> j=0;j&lt;=yMax-yMin;j++,lPtr++)
00493     {
00494       lPtr-&gt;layers &amp;= toClear;
00495       lPtr-&gt;visited =0;
00496       lPtr-&gt;termNo = 0;
00497       lPtr-&gt;upWay &amp;= toClear;
00498       lPtr-&gt;downWay &amp;= toClear;
00499       lPtr-&gt;rightWay &amp;= toClear;
00500       lPtr-&gt;leftWay &amp;= toClear;
00501     }
00502   }
00503 }<font class="comment">// LayMap::refresh  //</font>
00504 
00505 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00506"></a><a class="code" href="class_laymap.html#c5">00506</a>                <font class="keywordtype">void</font>  <a class="code" href="class_laymap.html#c5">LayMap::addTerms</a>(<font class="keywordtype">short</font> *mtx)
00507 <font class="comment">//</font>
00508 <font class="comment">//  Adds terminals after applying matrix mtx</font>
00509 {
00510   <font class="keywordtype">int</font> out[2],in[2];
00511   
00512   <font class="keywordflow">for</font>(LAYPORT *pPtr=layout-&gt;layport;pPtr!=NULL;pPtr=pPtr-&gt;next)
00513   {
00514     in[HOR]=pPtr-&gt;pos[HOR];
00515     in[VER]=pPtr-&gt;pos[VER];
00516 
00517     <a class="code" href="mtx.C.html#a3">mtxapply</a>(out,in,mtx);
00518     map[out[HOR]-xMin][out[VER]-yMin].termNo=(<font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>)pPtr-&gt;flag.l;  
00519                                                   <font class="comment">// here there's previously</font>
00520                                                   <font class="comment">// recognized "free" net</font>
00521                                                   <font class="comment">// number or 1 when this</font>
00522                                                   <font class="comment">// "contrained"</font>
00523   }
00524 }<font class="comment">// LayMap::addTerms  //</font>
00525 
00526 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00527"></a><a class="code" href="class_laymap.html#c6">00527</a>                <font class="keywordtype">void</font>  <a class="code" href="class_laymap.html#c6">LayMap::recognizeTerminals</a>()
00528 <font class="comment">//</font>
00529 <font class="comment">// Recognizes terminals of this layout : Each gets a number. When a terminal</font>
00530 <font class="comment">// name is one of user defined "free" nets then number = position in array+2.</font>
00531 <font class="comment">// It's because in map 0 means "no terminal" and "1"  "contrained" net, </font>
00532 <font class="comment">// otherwise number == 1.</font>
00533 {
00534   <font class="keywordflow">for</font>(LAYPORT *pPtr=layout-&gt;layport;pPtr!=NULL;pPtr=pPtr-&gt;next)
00535   {
00536     <a class="code" href="class_arrayiterator.html">ArrayIterator</a> aIter(*freeNets);
00537     <font class="keywordtype">int</font>  pos=0;
00538     
00539     <font class="keywordflow">for</font>(;(<a class="code" href="class_item.html">Item</a>&amp;)aIter != NOITEM;aIter++,pos++)
00540     {
00541       <a class="code" href="class_crinet.html">CriNet</a> &amp;net = (<a class="code" href="class_crinet.html">CriNet</a>&amp;)(<a class="code" href="class_item.html">Item</a>&amp;)aIter;
00542       <font class="keywordflow">if</font> ( pPtr-&gt;cirport-&gt;name == net.name )
00543     <font class="keywordflow">break</font>;
00544     }
00545     <font class="keywordflow">if</font>((<a class="code" href="class_item.html">Item</a>&amp;)aIter == NOITEM)       <font class="comment">// no such name =&gt; "constrained" net</font>
00546       pPtr-&gt;flag.l=1;
00547     <font class="keywordflow">else</font>
00548       pPtr-&gt;flag.l=pos+2;      
00549   }
00550 }<font class="comment">// LayMap::recognizeTerminals  //</font>
00551 
00552 
00553 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00554"></a><a class="code" href="class_laymap.html#c7">00554</a>                <font class="keywordtype">void</font>  <a class="code" href="class_laymap.html#c7">LayMap::clearFlags</a>()
00555 <font class="comment">//</font>
00556 <font class="comment">// Clears "visited" flags.</font>
00557 {
00558   <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i=0;i&lt;=xMax-xMin;i++)
00559   {
00560     <a class="code" href="class_layoutmaptype.html">layoutMapType</a> *lPtr = map[i];
00561 
00562     <font class="keywordflow">for</font>(<font class="keywordtype">int</font> j=0;j&lt;=yMax-yMin;j++,lPtr++)
00563     {
00564       lPtr-&gt;visited=0;
00565     }
00566   }
00567 }<font class="comment">// LayMap::clearFlags  //</font>
00568 
00569 
00570 
00571 
00572 
00573 
00574 
00575 
</div></pre><hr><address><small>Generated at Thu Sep 28 15:37:58 2000 for madonna by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align=center border=0 
width=110 height=53></a>1.1.5 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy; 1997-2000</small></address>
</body>
</html>
