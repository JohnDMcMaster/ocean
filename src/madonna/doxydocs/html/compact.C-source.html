<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<title>compact.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.1.5 on Thu Sep 28 15:37:54 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>compact.C</h1><a href="compact.C.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">// ***************************************************************************</font>
00002 <font class="comment">// *  COMPACT.C - Routine performing the compaction of layout.               *</font>
00003 <font class="comment">// *                                                                         *</font>
00004 <font class="comment">// *  Author : Ireneusz Karkowski 1991                                       *</font>
00005 <font class="comment">// *    @(#)compact.C 1.12 09/01/99 Delft University of Technology </font>
00006 <font class="comment">// ***************************************************************************</font>
00007 
00008 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00009 <font class="preprocessor">#include &lt;math.h&gt;</font>
00010 <font class="preprocessor">#include &lt;string.h&gt;</font>
00011 <font class="preprocessor">#include "<a class="code" href="plcm.h.html">plcm.h</a>"</font>
00012 
00013 <font class="comment">// in current version compaction is optional and it's goal is not to obtain</font>
00014 <font class="comment">// given magnification coef. (which does not longer exist) but rather to make</font>
00015 <font class="comment">// layout as dense as possible.</font>
00016 
00017 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00018"></a><a class="code" href="class_plcm.html#a8">00018</a>                <font class="keywordtype">void</font> <a class="code" href="class_plcm.html#a8">Plcm::compaction</a>(<font class="keywordtype">void</font> )
00019 <font class="comment">//</font>
00020 <font class="comment">// Compaction routine - deletes empty rows or colums from created layout</font>
00021 <font class="comment">// until the  required magnification coeficient is obtained.</font>
00022 <font class="comment">// Subsequently are checked all rows or  colums starting  from each</font>
00023 <font class="comment">// of borders.</font>
00024 <font class="comment">//</font>
00025 {
00026 
00027   compactType  dir1,dir2;
00028 
00029   <font class="keywordtype">int</font> ccx=layoutToBuild-&gt;bbx[HOR]/thisImage.size[HOR],
00030       ccy=layoutToBuild-&gt;bbx[VER]/thisImage.size[VER];
00031   
00032 
00033 
00034 
00035   <font class="keywordflow">if</font> (sizeOk(ccy,ccx))
00036   {
00037     cout &lt;&lt; <font class="stringliteral">"\n       No compaction necessary.\n"</font> &lt;&lt; endl; 
00038     <font class="keywordflow">return</font>;
00039   }
00040 
00041 
00042   <font class="keywordflow">if</font>( layoutToBuild-&gt;bbx[HOR]  &gt; layoutToBuild-&gt;bbx[VER])
00043   {
00044     dir1=HorizC;
00045     dir2=VertC;
00046   }
00047   <font class="keywordflow">else</font>
00048   {
00049     dir1=VertC;
00050     dir2=HorizC;
00051   }  
00052   
00053 
00054   <font class="keywordflow">if</font>( ! compactSide(dir1,ccx,ccy) )
00055     compactSide(dir2,ccx,ccy);
00056 
00057   <font class="keywordtype">double</font> area= layoutToBuild-&gt;bbx[HOR] *
00058                layoutToBuild-&gt;bbx[VER];     
00059 
00060 
00061   cout &lt;&lt; <font class="stringliteral">"\n         Magnification coefficient obtained :"</font> &lt;&lt; 
00062            area / totalArea &lt;&lt; endl &lt;&lt; endl;
00063 
00064 }<font class="comment">// Plcm::compaction  //</font>
00065 
00066 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00067"></a><a class="code" href="class_plcm.html#c16">00067</a> Boolean <a class="code" href="class_plcm.html#c16">Plcm::compactSide</a>(compactType whichDir,<font class="keywordtype">int</font> ccx,<font class="keywordtype">int</font> ccy)
00068 <font class="comment">//</font>
00069 <font class="comment">// Compacing in one direction. Returns true if required magnification coeficient</font>
00070 <font class="comment">// obtained.</font>
00071 <font class="comment">//</font>
00072 {
00073   <font class="keywordtype">int</font> actSize,savSize,otherSize,end;
00074 
00075   <font class="keywordflow">if</font>(whichDir == HorizC)
00076   {
00077     otherSize=ccy;
00078     actSize=end=ccx;
00079   }
00080   <font class="keywordflow">else</font>
00081   {
00082     otherSize=ccx;
00083     actSize=end=ccy;
00084   }
00085 
00086   <font class="keywordtype">int</font>  mid,
00087        pos1=0,npos1=0,
00088        pos2=end-1,npos2=end-1;
00089 
00090   savSize=actSize;
00091   mid=end/2;
00092   end--;
00093 
00094   <font class="keywordflow">for</font>( ;pos1 &lt; mid &amp;&amp; pos2 &gt;= mid;pos1++,pos2--,npos2--) 
00095   {
00096     <font class="keywordflow">if</font> (isEmpty(pos1,otherSize,whichDir) &amp;&amp; 
00097     (pos1==0 || noConflicts(pos1,otherSize,whichDir) ) )
00098     {
00099       actSize--;
00100       deletePos(npos1,whichDir);
00101       npos2--;
00102     }
00103     <font class="keywordflow">else</font>
00104       npos1++;
00105 
00106     <font class="keywordflow">if</font> (isEmpty(pos2,otherSize,whichDir) &amp;&amp;
00107     (pos2== end || noConflicts(pos2,otherSize,whichDir) ) )
00108     {
00109       actSize--;
00110       deletePos(npos2,whichDir); 
00111     }
00112     
00113     <font class="keywordflow">if</font> (sizeOk(actSize,otherSize) )    <font class="comment">// further compaction not required</font>
00114       <font class="keywordflow">break</font>;
00115   }
00116   <font class="keywordflow">if</font> (savSize-actSize &gt;0)
00117     <font class="keywordflow">if</font>(whichDir==HorizC)
00118     {
00119             cout &lt;&lt; <font class="stringliteral">"\n         "</font> &lt;&lt; (savSize-actSize) &lt;&lt; <font class="stringliteral">"  column[s] deleted."</font> &lt;&lt; endl;
00120       layoutToBuild-&gt;bbx[HOR]=actSize*thisImage.size[HOR]+thisImage.overlap[HOR];
00121     }
00122     <font class="keywordflow">else</font>
00123     {
00124             cout &lt;&lt; <font class="stringliteral">"\n         "</font> &lt;&lt; (savSize-actSize) &lt;&lt; <font class="stringliteral">"  row[s] deleted."</font> &lt;&lt; endl;
00125       layoutToBuild-&gt;bbx[VER]=actSize*thisImage.size[VER]+thisImage.overlap[VER];;
00126     }
00127   <font class="keywordflow">return</font>(sizeOk(actSize,otherSize));
00128 
00129 }<font class="comment">// Plcm::compactSide  //</font>
00130 
00131 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00132"></a><a class="code" href="class_plcm.html#c17">00132</a>                Boolean <a class="code" href="class_plcm.html#c17">Plcm::isEmpty</a>(<font class="keywordtype">int</font> pos,<font class="keywordtype">int</font> len,compactType dir)
00133 <font class="comment">//</font>
00134 <font class="comment">//  Return true if row (or column) at pos can be deleted. Len - length of row</font>
00135 <font class="comment">//  (or column).</font>
00136 {
00137   clusterMapType  cell;
00138   <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i=0;i&lt;len;i++)
00139   {
00140     <font class="keywordflow">if</font>(dir == HorizC)
00141       cell=plane-&gt;getPattern(pos,i);   <font class="comment">// checking column </font>
00142     <font class="keywordflow">else</font>
00143       cell=plane-&gt;getPattern(i,pos);   <font class="comment">// checking row</font>
00144     <font class="keywordflow">if</font> (cell != 0)
00145       <font class="keywordflow">return</font> <font class="keyword">false</font>;
00146   }
00147   <font class="keywordflow">return</font> <font class="keyword">true</font>;
00148 
00149 }<font class="comment">// Plcm::isEmpty  //</font>
00150 
00151 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00152"></a><a class="code" href="class_plcm.html#c18">00152</a>                Boolean <a class="code" href="class_plcm.html#c18">Plcm::noConflicts</a>(<font class="keywordtype">int</font> pos,<font class="keywordtype">int</font> len,compactType dir)
00153 <font class="comment">//</font>
00154 <font class="comment">//  Check if line at pos can be deleted from the point of view of critical</font>
00155 <font class="comment">//  points.</font>
00156 {
00157   <font class="keywordtype">int</font> x=pos-1,
00158       y=pos+1;
00159 
00160   <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i=0;i&lt;len;i++)
00161   {
00162     <font class="keywordflow">if</font>(dir == HorizC)
00163     {
00164       <a class="code" href="class_list.html">List</a> &amp;list1 = plane-&gt;getCriticals(x,i);
00165       <a class="code" href="class_list.html">List</a> &amp;list2 = plane-&gt;getCriticals(y,i);
00166       <font class="keywordflow">if</font> ( mayBeJoined(list1,list2,dir) )
00167     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00168     }
00169     <font class="keywordflow">else</font>
00170     {
00171       <a class="code" href="class_list.html">List</a> &amp;list1 = plane-&gt;getCriticals(i,x);
00172       <a class="code" href="class_list.html">List</a> &amp;list2 = plane-&gt;getCriticals(i,y);
00173       <font class="keywordflow">if</font> ( mayBeJoined(list1,list2,dir) )
00174     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00175     }
00176   }
00177   <font class="keywordflow">return</font> <font class="keyword">true</font>;
00178 
00179 }<font class="comment">// Plcm::noConflicts  //</font>
00180 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00181"></a><a class="code" href="class_plcm.html#c19">00181</a>                <font class="keywordtype">void</font>  <a class="code" href="class_plcm.html#c19">Plcm::deletePos</a>(<font class="keywordtype">int</font> pos,compactType dir)
00182 <font class="comment">//</font>
00183 <font class="comment">// Really moves elements laying over this position by one basic cell down.</font>
00184 <font class="comment">// Also if we have a licing layout it updates slices infomrations</font>
00185 {
00186   <font class="keywordtype">int</font> offset;
00187 
00188   <font class="keywordflow">if</font>(dir == HorizC)
00189     offset=thisImage.size[HOR];    
00190   <font class="keywordflow">else</font>
00191     offset=thisImage.size[VER];    
00192   
00193   <font class="keywordflow">if</font>(slicingLayout)
00194   {
00195     <font class="keywordtype">int</font> i,j;
00196     SLICE* slvPtr,*slhPtr;
00197 
00198     <font class="keywordflow">for</font>(i=0,slvPtr=layoutToBuild-&gt;slice-&gt;chld.slice;
00199     slvPtr!=NULL &amp;&amp; i&lt;slicesInHor;i++,slvPtr=slvPtr-&gt;next)
00200       <font class="keywordflow">for</font>(j=0,slhPtr=slvPtr-&gt;chld.slice;
00201           slhPtr!=NULL &amp;&amp; j&lt;slicesInVer;j++,slhPtr=slhPtr-&gt;next)
00202       {
00203                 <font class="comment">// we let\'s find out if this one has to </font>
00204                 <font class="comment">// be updated</font>
00205 
00206     <a class="code" href="class__slice_info.html">SLICE_INFO</a>* tdPtr=(<a class="code" href="class__slice_info.html">SLICE_INFO</a>*)slhPtr-&gt;flag.p;
00207     
00208     <font class="keywordflow">if</font> (tdPtr-&gt;layerTrans != NULL)
00209       cerr &lt;&lt; <font class="stringliteral">"Warning : Compact - you shouldn't do compactions after \n"</font>
00210            &lt;&lt; <font class="stringliteral">"          transparency analysis ! "</font> &lt;&lt; endl;
00211 
00212     <font class="keywordflow">if</font>(dir == HorizC)
00213     {
00214       <font class="keywordflow">if</font>(tdPtr-&gt;cX + tdPtr-&gt;width &gt;= pos)         
00215         <font class="keywordflow">for</font>(LAYINSTPTR lPtr=slhPtr-&gt;chld.layinst;lPtr != NULL;lPtr=lPtr-&gt;next)
00216           moveCell(lPtr,dir,pos,offset);
00217 
00218       <font class="keywordflow">if</font>(tdPtr-&gt;cX &lt;= pos &amp;&amp; tdPtr-&gt;cX+tdPtr-&gt;width &gt; pos)
00219         tdPtr-&gt;width--; <font class="comment">// only shrink it</font>
00220       <font class="keywordflow">if</font>(tdPtr-&gt;cX &gt; pos)   <font class="comment">// only shift</font>
00221         tdPtr-&gt;cX--;
00222     }
00223     <font class="keywordflow">else</font>
00224     {
00225       <font class="keywordflow">if</font> (tdPtr-&gt;cY + tdPtr-&gt;height &gt;= pos)
00226         <font class="keywordflow">for</font>(LAYINSTPTR lPtr=slhPtr-&gt;chld.layinst;lPtr != NULL;lPtr=lPtr-&gt;next)
00227           moveCell(lPtr,dir,pos,offset);
00228       <font class="keywordflow">if</font>(tdPtr-&gt;cY &lt;= pos &amp;&amp; tdPtr-&gt;cY+tdPtr-&gt;height &gt; pos)
00229         tdPtr-&gt;height--;    <font class="comment">// only shrink it</font>
00230 
00231       <font class="keywordflow">if</font>(tdPtr-&gt;cY &gt; pos)   <font class="comment">// only shift</font>
00232         tdPtr-&gt;cY--;
00233     }
00234       }
00235   }
00236   <font class="keywordflow">else</font>
00237     <font class="keywordflow">for</font>(LAYINST *liPtr=*layInstancesList;liPtr!=NULL;liPtr=liPtr-&gt;next)
00238       moveCell(liPtr,dir,pos,offset);
00239 
00240 }<font class="comment">// Plcm::deletePos  //</font>
00241 
00242 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00243"></a><a class="code" href="class_plcm.html#c20">00243</a>                Boolean <a class="code" href="class_plcm.html#c20">Plcm::sizeOk</a>(<font class="keywordtype">int</font> <font class="comment">/* a */</font>, <font class="keywordtype">int</font> <font class="comment">/* b */</font>)
00244 <font class="comment">// </font>
00245 <font class="comment">// Returns true if given sizes are already nearly equal. (+- 5%).</font>
00246 {
00247 <font class="comment">//   double x=a*thisImage.size[HOR];</font>
00248 <font class="comment">//   double y=b*thisImage.size[VER];</font>
00249 <font class="comment">//   double act=x*y;</font>
00250 <font class="comment">// </font>
00251 <font class="comment">//   if ( act == 0 )</font>
00252 <font class="comment">//     return true;</font>
00253 <font class="comment">// </font>
00254 <font class="comment">//   if ( (act - totalArea*magnification )/act &lt; 0.05)</font>
00255 <font class="comment">//     return true;</font>
00256 <font class="comment">//   else</font>
00257 
00258     <font class="keywordflow">return</font> <font class="keyword">false</font>; 
00259 
00260 }<font class="comment">// Plcm::sizeOk  //</font>
00261 
00262 
00263 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00264"></a><a class="code" href="class_plcm.html#c21">00264</a>                Boolean <a class="code" href="class_plcm.html#c21">Plcm::mayBeJoined</a>(<a class="code" href="class_list.html">List</a> &amp;l1,<a class="code" href="class_list.html">List</a> &amp;l2,compactType dir)
00265 <font class="comment">//</font>
00266 <font class="comment">// </font>
00267 {
00268   <font class="keywordtype">int</font> max;
00269 
00270   <font class="keywordflow">if</font>(dir == HorizC)
00271     max=thisImage.size[HOR]-1;
00272   <font class="keywordflow">else</font>
00273     max=thisImage.size[VER]-1;    
00274   
00275   
00276   <font class="keywordflow">if</font> ( l2.<a class="code" href="class_box.html#a12">getItemsInBox</a>())
00277   {  
00278     <a class="code" href="class_listiterator.html">ListIterator</a> crIter(l2);
00279     
00280     <font class="keywordflow">for</font>(;(<a class="code" href="class_item.html">Item</a>&amp;)crIter != NOITEM;crIter++)
00281     {
00282       <a class="code" href="class_cripoint.html">CriPoint</a> &amp;trRef = (<a class="code" href="class_cripoint.html">CriPoint</a>&amp;)(<a class="code" href="class_item.html">Item</a>&amp;)crIter;
00283       <font class="keywordflow">if</font> ( dir==HorizC &amp;&amp; trRef.x == 0 || dir == VertC &amp;&amp; trRef.y == 0)
00284       {
00285     <a class="code" href="class_cripoint.html">CriPoint</a> tmp=trRef;
00286     
00287     <font class="keywordflow">if</font>(dir == HorizC)
00288       tmp.x = max;
00289     <font class="keywordflow">else</font>
00290       tmp.y = max;
00291     
00292     <a class="code" href="class_cripoint.html">CriPoint</a> &amp;foundRef = (<a class="code" href="class_cripoint.html">CriPoint</a>&amp;)l1.<a class="code" href="class_package.html#a5">findItem</a>(tmp);
00293     <font class="keywordflow">if</font> ( foundRef != NOITEM )
00294     {
00295       <font class="keywordflow">if</font> (trRef.net == 1 || foundRef.net == 1 || trRef.net != foundRef.net )
00296         
00297         <font class="comment">// .net == 0 means constrained net</font>
00298         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00299     }
00300       }
00301     }
00302   }
00303   <font class="keywordflow">return</font> <font class="keyword">false</font>;
00304 
00305 }<font class="comment">// Plcm::mayBeJoined  //</font>
00306 
00307 
00308 <font class="comment">//----------------------------------------------------------------------------</font>
<a name="l00309"></a><a class="code" href="class_plcm.html#c22">00309</a> <font class="keywordtype">void</font> <a class="code" href="class_plcm.html#c22">Plcm::moveCell</a>(LAYINST *liPtr,compactType dir,<font class="keywordtype">int</font> pos,<font class="keywordtype">int</font> offset)
00310 <font class="comment">//</font>
00311 <font class="comment">//</font>
00312 {
00313   <font class="keywordtype">int</font> aPos;
00314 
00315   <font class="keywordflow">if</font>(dir == HorizC)
00316     aPos = liPtr-&gt;flag.s[0];
00317   <font class="keywordflow">else</font>
00318     aPos = liPtr-&gt;flag.s[1];
00319   
00320   <font class="keywordflow">if</font> ( aPos &gt; pos )  <font class="comment">//  lets move it</font>
00321   {
00322     <font class="keywordflow">if</font>(dir == HorizC)
00323     {
00324       liPtr-&gt;flag.s[0]--;   
00325       liPtr-&gt;mtx[B1]-=offset;   
00326     }
00327     <font class="keywordflow">else</font>
00328     {
00329       liPtr-&gt;flag.s[1]--;
00330       liPtr-&gt;mtx[B2]-=offset;   
00331     }
00332   }
00333 }<font class="comment">// Plcm::moveCell  //</font>
</div></pre><hr><address><small>Generated at Thu Sep 28 15:37:54 2000 for madonna by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align=center border=0 
width=110 height=53></a>1.1.5 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy; 1997-2000</small></address>
</body>
</html>
