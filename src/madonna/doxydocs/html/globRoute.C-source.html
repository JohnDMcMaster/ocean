<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<title>globRoute.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.1.5 on Thu Sep 28 15:37:56 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>globRoute.C</h1><a href="globRoute.C.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">//</font>
00002 <font class="comment">//  @(#)globRoute.C 1.7 08/20/96 </font>
00003 <font class="comment">// </font>
00004 
00005 <font class="preprocessor">#include "<a class="code" href="genpart.h.html">genpart.h</a>"</font>
00006 <font class="preprocessor">#include "<a class="code" href="globRoute.h.html">globRoute.h</a>"</font>
00007 <font class="preprocessor">#include "<a class="code" href="phil_glob.h.html">phil_glob.h</a>"</font>      <font class="comment">// for getImageDesc()</font>
00008 <font class="preprocessor">#include &lt;string.h&gt;</font>
00009 <font class="preprocessor">#include &lt;malloc.h&gt;</font>             <font class="comment">// only necessary for dbmalloc (debugging)</font>
00010 
00011 <font class="comment">// imported from main.C:</font>
<a name="l00012"></a><a class="code" href="globRoute.C.html#a4">00012</a> <font class="keyword">extern</font> STRING RouteAsciiFile; <font class="comment">// name of the file to dump global routes on</font>
00013 
00014 
00015 
00016 <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="globRoute.C.html#a0">acceptBranch</a>(<a class="code" href="class_sdfset.html">sdfset</a>&amp; branch, treeEdgeInfo&amp; steInfo);
00017 <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="globRoute.C.html#a1">checkThisEdgeSide</a>(treeEdge *te, <a class="code" href="class_expansiongridvertex.html">expansionGridVertex</a> *vx,
00018                  treeEdgeInfo&amp; steInfo);
00019 <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="globRoute.C.html#a0">acceptBranch</a>(<a class="code" href="class_sdfset.html">sdfset</a>&amp; branch, treeEdgeInfo&amp; steInfo);
00020 <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="globRoute.C.html#a1">checkThisEdgeSide</a>(treeEdge *te, <a class="code" href="class_expansiongridvertex.html">expansionGridVertex</a> *vx,
00021                  treeEdgeInfo&amp; steInfo);
00022 <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="globRoute.C.html#a2">makeRoutingInfo</a>(<a class="code" href="class__routing_info.html">ROUTING_INFO</a>&amp; rinfo, <font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y);
00023 <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="globRoute.C.html#a3">isPowerOrGroundNet</a>(NETPTR net);
00024 
00025 
00026 <font class="comment">// Constructor: build an expansion grid and a set of globNets</font>
<a name="l00027"></a><a class="code" href="class_expansiongrid.html#a0">00027</a> <a class="code" href="class_expansiongrid.html#a0">expansionGrid::expansionGrid</a>(<a class="code" href="class__totalp.html">TOTALPPTR</a> total):
00028 thegraph(<font class="stringliteral">"expansion grid"</font>, SetCurrentGraph),
00029 theglobnets(NonOrderedSet, <font class="stringliteral">"global nets"</font>),
00030 thematrix(2*total-&gt;nx - 1, 2*total-&gt;ny - 1)<font class="keyword">
</font>00031 <font class="keyword"></font>{
00032    totalp = total;
00033    heavyWeight = 100;
00034    lightWeightHorizontal = 1;
00035    lightWeightVertical = 1;
00036    image = <a class="code" href="phil.C.html#a3">getImageDesc</a>(); <font class="comment">// get stuff from image.seadif</font>
00037    buildExpansionGrid();
00038    buildGlobNets();
00039    cout &lt;&lt; <font class="stringliteral">"------ "</font> &lt;&lt; theglobnets.size() &lt;&lt; <font class="stringliteral">" nets have to be routed on a "</font>
00040     &lt;&lt; nx() &lt;&lt; <font class="stringliteral">" x "</font> &lt;&lt; ny() &lt;&lt; <font class="stringliteral">" global grid"</font> &lt;&lt; endl;
00041 }
00042 
00043 
<a name="l00044"></a><a class="code" href="class_expansiongrid.html#c0">00044</a> <font class="keywordtype">void</font> <a class="code" href="class_expansiongrid.html#c0">expansionGrid::buildExpansionGrid</a>()<font class="keyword">
</font>00045 <font class="keyword"></font>{
00046    <font class="comment">// first create the vertices of the expansion grid:</font>
00047    <a class="code" href="class_expansiongrid.html#c1">buildExpansionGridVertices</a>();
00048    <font class="comment">// now create all the edges between the vertices in the grid:</font>
00049    <a class="code" href="class_expansiongrid.html#c2">buildExpansionGridEdges</a>();
00050 }
00051 
00052 
<a name="l00053"></a><a class="code" href="class_expansiongrid.html#c1">00053</a> <font class="keywordtype">void</font> <a class="code" href="class_expansiongrid.html#c1">expansionGrid::buildExpansionGridVertices</a>()<font class="keyword">
</font>00054 <font class="keyword"></font>{
00055    <font class="keywordflow">for</font> (CIRINSTPTR ci = totalp-&gt;bestpart-&gt;cirinst; ci != NIL; ci = ci-&gt;next)
00056    {
00057       <font class="keywordtype">int</font> x, y;
00058       <a class="code" href="class_expansiongrid.html#a3">instance2xy</a>(ci, x, y);    <font class="comment">// set x,y to the coordinate in the grid.</font>
00059       <font class="comment">// create an expansionGridVertex that represents the partition, insert it</font>
00060       <font class="comment">// in the matrix:</font>
00061       <a class="code" href="class_expansiongridvertex.html">expansionGridVertex</a> *egv =
00062      <font class="keyword">new</font> expansionGridVertex(ci-&gt;circuit, PartitionGV, x, y);
00063       thematrix[x][y] = egv;
00064       <font class="keywordflow">if</font> ( x+1 &lt; <a class="code" href="class_expansiongrid.html#a1">nx</a>() )
00065       {  <font class="comment">// this vertex represents a vertical channel:</font>
00066      egv = <font class="keyword">new</font> expansionGridVertex(NIL, VerticalChannelGV, x+1, y);
00067      thematrix[x+1][y] = egv;
00068       }
00069       <font class="keywordflow">if</font> ( y+1 &lt; <a class="code" href="class_expansiongrid.html#a2">ny</a>() )
00070       {  <font class="comment">// this vertex represents a horizontal channel:</font>
00071      egv = <font class="keyword">new</font> expansionGridVertex(NIL, HorizontalChannelGV, x, y+1);
00072      thematrix[x][y+1] = egv;
00073       }
00074       <font class="keywordflow">if</font> ( x+1 &lt; <a class="code" href="class_expansiongrid.html#a1">nx</a>() &amp;&amp; y+1 &lt; <a class="code" href="class_expansiongrid.html#a2">ny</a>() )
00075       {  <font class="comment">// this vertex represents a channel crossing:</font>
00076      egv = <font class="keyword">new</font> expansionGridVertex(NIL, ChannelCrossingGV, x+1, y+1);
00077      thematrix[x+1][y+1] = egv;
00078       }
00079    }
00080 }
00081 
00082 
00083 <font class="comment">// create all the edges between the vertices in the grid:</font>
<a name="l00084"></a><a class="code" href="class_expansiongrid.html#c2">00084</a> <font class="keywordtype">void</font> <a class="code" href="class_expansiongrid.html#c2">expansionGrid::buildExpansionGridEdges</a>()<font class="keyword">
</font>00085 <font class="keyword"></font>{
00086    <font class="keywordflow">for</font> (<font class="keywordtype">int</font> x = 0; x &lt; <a class="code" href="class_expansiongrid.html#a1">nx</a>(); ++x)
00087       <font class="keywordflow">for</font> (<font class="keywordtype">int</font> y = 0; y &lt; <a class="code" href="class_expansiongrid.html#a2">ny</a>(); ++y)
00088       {
00089      <font class="comment">// internal consistency check:</font>
00090      <font class="keywordflow">if</font> (thematrix[x][y] == NIL)
00091         <a class="code" href="class_expansiongrid.html#c9">EGerror</a>(<font class="stringliteral">"FATAL INTERNAL CONSISTENCY: thematrix[][] == NIL"</font>);
00092      <font class="keywordflow">switch</font> (thematrix[x][y]-&gt;type())
00093      {
00094      <font class="keywordflow">case</font> PartitionGV:
00095         <a class="code" href="class_expansiongrid.html#c3">makeEdge</a>(x, y, HorizontalEdge, heavyWeight);
00096         <a class="code" href="class_expansiongrid.html#c3">makeEdge</a>(x, y, VerticalEdge, heavyWeight);
00097         <font class="keywordflow">break</font>;
00098      <font class="keywordflow">case</font> HorizontalChannelGV:
00099         <a class="code" href="class_expansiongrid.html#c3">makeEdge</a>(x, y, HorizontalEdge, lightWeightHorizontal);
00100         <a class="code" href="class_expansiongrid.html#c3">makeEdge</a>(x, y, VerticalEdge, heavyWeight);
00101         <font class="keywordflow">break</font>;
00102      <font class="keywordflow">case</font> VerticalChannelGV:
00103         <a class="code" href="class_expansiongrid.html#c3">makeEdge</a>(x, y, HorizontalEdge, heavyWeight);
00104         <a class="code" href="class_expansiongrid.html#c3">makeEdge</a>(x, y, VerticalEdge, lightWeightVertical);
00105         <font class="keywordflow">break</font>;
00106      <font class="keywordflow">case</font> ChannelCrossingGV:
00107         <a class="code" href="class_expansiongrid.html#c3">makeEdge</a>(x, y, HorizontalEdge, lightWeightHorizontal);
00108         <a class="code" href="class_expansiongrid.html#c3">makeEdge</a>(x, y, VerticalEdge, lightWeightVertical);
00109         <font class="keywordflow">break</font>;
00110      <font class="keywordflow">default</font>:
00111         <a class="code" href="class_expansiongrid.html#c9">EGerror</a>(<font class="stringliteral">"FATAL INTERNAL CONSISTENCY: thematrix[][].type()"</font>);
00112         <font class="keywordflow">break</font>;
00113      }
00114       }
00115 }
00116 
<a name="l00117"></a><a class="code" href="class_expansiongrid.html#c3">00117</a> <font class="keywordtype">void</font> <a class="code" href="class_expansiongrid.html#c3">expansionGrid::makeEdge</a>(<font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y, edgeDirection dir, <font class="keywordtype">int</font> weight)<font class="keyword">
</font>00118 <font class="keyword"></font>{
00119    <a class="code" href="class_expansiongridedge.html">expansionGridEdge</a> *e;
00120    <font class="keywordflow">if</font> ( dir == HorizontalEdge)
00121    {
00122       <font class="keywordflow">if</font> ( x+1 &lt; <a class="code" href="class_expansiongrid.html#a1">nx</a>() )
00123       {
00124       <font class="comment">// create a horizontal edge:</font>
00125       e = <font class="keyword">new</font> expansionGridEdge(weight,x,y,HorizontalEdge);
00126       <a class="code" href="class_expansiongridterminal.html">expansionGridTerminal</a> *tl = <font class="keyword">new</font> expansionGridTerminal(East);
00127       <a class="code" href="class_expansiongridterminal.html">expansionGridTerminal</a> *tr = <font class="keyword">new</font> expansionGridTerminal(West);
00128       e-&gt;addToEdge(thematrix[x][y], GenericEdge, tl)
00129      -&gt;addToEdge(thematrix[x+1][y], GenericEdge, tr);
00130       }
00131    }
00132    <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( dir == VerticalEdge )
00133    {
00134       <font class="keywordflow">if</font> ( y+1 &lt; <a class="code" href="class_expansiongrid.html#a2">ny</a>() )
00135       {
00136      <font class="comment">// create a vertical edge:</font>
00137      e =  <font class="keyword">new</font> expansionGridEdge(weight,x,y,VerticalEdge);
00138      <a class="code" href="class_expansiongridterminal.html">expansionGridTerminal</a> *tb = <font class="keyword">new</font> expansionGridTerminal(North);
00139      <a class="code" href="class_expansiongridterminal.html">expansionGridTerminal</a> *tt = <font class="keyword">new</font> expansionGridTerminal(South);
00140      e-&gt;addToEdge(thematrix[x][y], GenericEdge, tb)
00141         -&gt;addToEdge(thematrix[x][y+1], GenericEdge, tt);
00142       }
00143    }
00144    <font class="keywordflow">else</font>
00145       <a class="code" href="class_expansiongrid.html#c9">EGerror</a>(<font class="stringliteral">"FATAL INTERNAL: unknown edgeDirection"</font>);
00146 }
00147 
00148 
00149 <font class="comment">// A globNet ("global net") is a set of expansionGridVertices that are visited</font>
00150 <font class="comment">// by a net. This function builds a globNet for each net in the partitioned</font>
00151 <font class="comment">// circuit.</font>
<a name="l00152"></a><a class="code" href="class_expansiongrid.html#c4">00152</a> <font class="keywordtype">void</font> <a class="code" href="class_expansiongrid.html#c4">expansionGrid::buildGlobNets</a>()<font class="keyword">
</font>00153 <font class="keyword"></font>{
00154    <font class="keywordflow">for</font> (NETPTR net = totalp-&gt;bestpart-&gt;netlist; net != NIL; net = net-&gt;next)
00155    {
00156       <font class="keywordflow">if</font> (<a class="code" href="globRoute.C.html#a3">isPowerOrGroundNet</a>(net))
00157      <font class="keywordflow">continue</font>; <font class="comment">// not routing power or ground because it is part of image</font>
00158       <a class="code" href="class_globnet.html">globNet</a> *globnet = <font class="keyword">new</font> globNet(net);
00159       <font class="keywordflow">for</font> (CIRPORTREFPTR cpr = net-&gt;terminals; cpr != NIL; cpr = cpr-&gt;next)
00160       {
00161      <font class="keywordflow">if</font> (cpr-&gt;cirinst == NIL)
00162         <font class="keywordflow">continue</font>; <font class="comment">// not a terminal to an instance</font>
00163      <font class="comment">// which partition represents this instance?</font>
00164      <font class="keywordtype">int</font> x, y;
00165      <a class="code" href="class_expansiongrid.html#a3">instance2xy</a>(cpr-&gt;cirinst, x, y);
00166      <font class="comment">// Answer: the gridVertex in thematrix[x][y] ...!</font>
00167      <a class="code" href="class_globterm.html">globTerm</a> *globterm = <font class="keyword">new</font> globTerm(thematrix[x][y]);
00168      globnet-&gt;add(globterm);
00169       }
00170       <font class="keywordflow">if</font> (globnet-&gt;size() &gt; 1)
00171      theglobnets.add(globnet); <font class="comment">// add this globnet to the set of globl nets</font>
00172       <font class="keywordflow">else</font>
00173       {  <font class="comment">// this globNet is too small to be useful</font>
00174      globnet-&gt;delAll(); <font class="comment">// delete all globTerms from the globnet...</font>
00175      <font class="keyword">delete</font> globnet;    <font class="comment">// ...and get rid of the globNet itself.</font>
00176       }
00177    }
00178 }
00179 
00180 
00181 <font class="comment">// convert an instance name (= name of a partition) to (x,y) coordinates in the</font>
00182 <font class="comment">// expansion grid. Partition names are numerical strings "1", "2", ...</font>
00183 <font class="comment">//x</font>
<a name="l00184"></a><a class="code" href="class_expansiongrid.html#a3">00184</a> <font class="keywordtype">void</font> <a class="code" href="class_expansiongrid.html#a3">expansionGrid::instance2xy</a>(CIRINSTPTR cirinst, <font class="keywordtype">int</font>&amp; x, <font class="keywordtype">int</font>&amp; y)<font class="keyword">
</font>00185 <font class="keyword"></font>{
00186    <font class="keywordtype">int</font> n = atoi(cirinst-&gt;name) - 1; <font class="comment">// n is in the range 0...numparts-1</font>
00187    x = 2 * (n % totalp-&gt;nx);
00188    y = 2 * (n / totalp-&gt;nx);
00189 }
00190 
00191 
00192 <font class="comment">// constructor of a grid edge:</font>
00193 <font class="comment">//</font>
<a name="l00194"></a><a class="code" href="class_expansiongridedge.html#a0">00194</a> <a class="code" href="class_expansiongridedge.html#a0">expansionGridEdge::expansionGridEdge</a>(<font class="keywordtype">int</font> edgeLength, <font class="keywordtype">int</font> _x_, <font class="keywordtype">int</font> _y_,
00195                      edgeDirection dir)<font class="keyword">
</font>00196 <font class="keyword"></font>{
00197    _capacity = 0;      <font class="comment">// how many wires can be routed through this edge</font>
00198    _occupation = 0;    <font class="comment">// how many wires are actually routed through here</font>
00199    _length = edgeLength;   <font class="comment">// eg. the length of a wire that passes through here</font>
00200    underCapacityPenalty = 1;
00201    overCapacityReward = 1;
00202    _x = _x_;
00203    _y = _y_;
00204    _direction = dir;
00205 }
00206 
00207 
00208 <font class="comment">// this is the weight of the edge as it is taken into account by the steiner</font>
00209 <font class="comment">// tree function graphSteiner() from libocean:</font>
00210 <font class="comment">//</font>
<a name="l00211"></a><a class="code" href="class_expansiongridedge.html#a7">00211</a> <font class="keywordtype">int</font> <a class="code" href="class_expansiongridedge.html#a7">expansionGridEdge::eWeight</a>()<font class="keyword">
</font>00212 <font class="keyword"></font>{
00213    <font class="keywordflow">return</font> _length;
00214 }
00215 
00216 
<a name="l00217"></a><a class="code" href="class_expansiongridvertex.html#a0">00217</a> <a class="code" href="class_expansiongridvertex.html#a0">expansionGridVertex::expansionGridVertex</a>(CIRCUITPTR partition,
00218                      expansionGridVertexType t,
00219                      <font class="keywordtype">int</font> x_coord, <font class="keywordtype">int</font> y_coord)<font class="keyword">
</font>00220 <font class="keyword"></font>{
00221    _partition = partition;
00222    _type = t;
00223    _x_coord = x_coord;
00224    _y_coord = y_coord;
00225 }
00226 
00227 
00228 <font class="comment">// print the global route of GNET to an ascii file:</font>
00229 <font class="comment">//</font>
<a name="l00230"></a><a class="code" href="class_expansiongrid.html#c7">00230</a> <font class="keywordtype">void</font> <a class="code" href="class_expansiongrid.html#c7">expansionGrid::printRouteGlobNet</a>(<a class="code" href="class_globnet.html">globNet</a> *gnet)<font class="keyword">
</font>00231 <font class="keyword"></font>{
00232    <font class="keywordflow">if</font> (RouteAsciiFile != NIL)
00233    {  <font class="comment">// the option -R&lt;filename&gt; was specified on the command line; print</font>
00234       <font class="comment">// an ascii representation of the global route taken by this net:</font>
00235       <font class="keyword">extern</font> filebuf RouteAsciiStreamBuf; <font class="comment">// file already opened in main()</font>
00236       ostream routeAsciiStream(&amp;RouteAsciiStreamBuf);
00237       routeAsciiStream &lt;&lt; gnet-&gt;net()-&gt;name &lt;&lt; <font class="stringliteral">" (terminals = "</font>
00238                &lt;&lt; gnet-&gt;size() &lt;&lt; <font class="stringliteral">", weight = "</font>
00239                &lt;&lt; gnet-&gt;<a class="code" href="class_globnet.html#a2">weight</a>() &lt;&lt; <font class="stringliteral">"):"</font> &lt;&lt; endl;
00240       <a class="code" href="class_expansiongrid.html#a10">printRoute</a>(gnet, routeAsciiStream);
00241       routeAsciiStream &lt;&lt; <font class="stringliteral">"\n\n\n"</font> &lt;&lt; flush;
00242    }
00243 }
00244 
00245 
00246 <font class="comment">// print the summary information in totalp-&gt;routing</font>
00247 <font class="comment">//</font>
<a name="l00248"></a><a class="code" href="class_expansiongrid.html#c8">00248</a> <font class="keywordtype">void</font> <a class="code" href="class_expansiongrid.html#c8">expansionGrid::printRouteSummary</a>()<font class="keyword">
</font>00249 <font class="keyword"></font>{
00250    <font class="keywordflow">if</font> (RouteAsciiFile != NIL)
00251    {  <font class="comment">// the option -R&lt;filename&gt; was specified on the command line; print</font>
00252       <font class="comment">// an ascii representation of the global route taken by this net:</font>
00253       <font class="keyword">extern</font> filebuf RouteAsciiStreamBuf; <font class="comment">// file already opened in main()</font>
00254       ostream routeAsciiStream(&amp;RouteAsciiStreamBuf);
00255       routeAsciiStream &lt;&lt; <font class="stringliteral">"Global routing summary:\n\n"</font> &lt;&lt; flush;
00256       <a class="code" href="class_expansiongrid.html#a11">printRouting</a>(routeAsciiStream);
00257       routeAsciiStream &lt;&lt; <font class="stringliteral">"\n\n\n"</font> &lt;&lt; flush;
00258    }
00259 }
00260 
00261 
00262 <font class="comment">// route all global nets:</font>
00263 <font class="comment">//</font>
<a name="l00264"></a><a class="code" href="class_expansiongrid.html#a5">00264</a> <font class="keywordtype">void</font> <a class="code" href="class_expansiongrid.html#a5">expansionGrid::routeGlobNets</a>()<font class="keyword">
</font>00265 <font class="keyword"></font>{
00266    theglobnets.ckConsistency();  <font class="comment">// internal consistency check</font>
00267    <font class="keywordtype">int</font> totalWeight = 0;
00268    sdfsetNextElmtIterator nextGlobNet(&amp;theglobnets); <font class="comment">// iterate all global nets</font>
00269    <a class="code" href="class_globnet.html">globNet</a> *gnet;
00270    <font class="keywordflow">while</font> (gnet = (<a class="code" href="class_globnet.html">globNet</a> *)nextGlobNet())
00271    {  <font class="comment">// for each global net ...</font>
00272 <font class="preprocessor">#ifdef _DEBUG_MALLOC_INC
</font>00273 <font class="preprocessor"></font>      <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font>  histid1, histid2, orig_size, current_size;
00274       orig_size = malloc_inuse(&amp;histid1);
00275 <font class="preprocessor">#endif
</font>00276 <font class="preprocessor"></font>      cout &lt;&lt; <font class="stringliteral">"     + routing net "</font> &lt;&lt; gnet-&gt;<a class="code" href="class_globnet.html#a1">net</a>()-&gt;name
00277        &lt;&lt; <font class="stringliteral">" ("</font> &lt;&lt; gnet-&gt;size() &lt;&lt; <font class="stringliteral">" terminals): "</font> &lt;&lt; flush;
00278       <a class="code" href="class_expansiongrid.html#a4">routeGlobNet</a>(gnet);   <font class="comment">// route this global net</font>
00279       <a class="code" href="class_expansiongrid.html#c7">printRouteGlobNet</a>(gnet);
00280       cout &lt;&lt; <font class="stringliteral">" weight = "</font> &lt;&lt; gnet-&gt;<a class="code" href="class_globnet.html#a2">weight</a>() &lt;&lt; endl;
00281       totalWeight += gnet-&gt;<a class="code" href="class_globnet.html#a2">weight</a>();
00282       gnet-&gt;route.delAll();      <font class="comment">// don't need treeEdges anymore</font>
00283 <font class="preprocessor">#ifdef _DEBUG_MALLOC_INC
</font>00284 <font class="preprocessor"></font>      current_size = malloc_inuse(&amp;histid2);
00285       <font class="keywordflow">if</font> (current_size != orig_size)
00286          malloc_list(2,histid1,histid2);
00287 <font class="preprocessor">#endif
</font>00288 <font class="preprocessor"></font>   }
00289    <a class="code" href="class_expansiongrid.html#a6">summarizeGlobNets</a>();     <font class="comment">// this builds the totalp-&gt;routing struct</font>
00290    <a class="code" href="class_expansiongrid.html#c8">printRouteSummary</a>();     <font class="comment">// ...and this prints it</font>
00291    cout &lt;&lt; <font class="stringliteral">"\n------ Routed "</font> &lt;&lt; theglobnets.size()
00292     &lt;&lt; <font class="stringliteral">" nets, total weight = "</font> &lt;&lt; totalWeight &lt;&lt; <font class="stringliteral">"\n\n"</font> &lt;&lt; endl;
00293    <font class="keywordflow">if</font> (RouteAsciiFile != NIL)
00294       cout &lt;&lt; <font class="stringliteral">"\n------ A report of the routing process has been "</font>
00295        &lt;&lt; <font class="stringliteral">"written to file \""</font> &lt;&lt; RouteAsciiFile &lt;&lt; <font class="stringliteral">"\""</font> &lt;&lt; endl;
00296 }
00297 
00298 
00299 <font class="comment">// route the global net GNET:</font>
<a name="l00300"></a><a class="code" href="class_expansiongrid.html#a4">00300</a> <font class="keywordtype">void</font> <a class="code" href="class_expansiongrid.html#a4">expansionGrid::routeGlobNet</a>(<a class="code" href="class_globnet.html">globNet</a> *gnet)<font class="keyword">
</font>00301 <font class="keyword"></font>{
00302    <a class="code" href="class_sdfset.html">sdfset</a> theSteinerEdges; <font class="comment">// this is a set of treeEdges, see &lt;graphSteiner.h&gt;</font>
00303    <font class="comment">// build minimal steiner tree, the weight of the tree is returned to w:</font>
00304    <font class="comment">/*
</font>00305 <font class="comment">   graphSteinOpts.installAcceptBranchFunction(&amp;acceptBranch); // less greedy!!
</font>00306 <font class="comment">   */</font>
00307    <font class="keywordtype">int</font> w = graphSteiner(thegraph, *gnet, theSteinerEdges);
00308    gnet-&gt;ckConsistency();
00309    gnet-&gt;<a class="code" href="class_globnet.html#a2">weight</a>(w);              <font class="comment">// remember weight of the tree</font>
00310    sdfsetNextElmtIterator nextTreeEdge(&amp;theSteinerEdges);
00311    treeEdge *te;
00312    <font class="keywordflow">while</font> (te = (treeEdge *)nextTreeEdge())
00313    {  <font class="comment">// increment the occupation of the edge by one:</font>
00314       <a class="code" href="class_expansiongridedge.html">expansionGridEdge</a> *ege = (<a class="code" href="class_expansiongridedge.html">expansionGridEdge</a> *)te-&gt;edge();
00315       ege-&gt;<a class="code" href="class_expansiongridedge.html#a1">addToOccupation</a>(1);
00316    }
00317    gnet-&gt;route.move(&amp;theSteinerEdges); <font class="comment">// store this steiner tree in gnet.route</font>
00318 }
00319 
00320 
00321 <font class="comment">// return TRUE if the branch is acceptable, NIL otherwise. This function is</font>
00322 <font class="comment">// called by graphSteiner() to check that a candidate steiner branch is good</font>
00323 <font class="comment">// enough for the steiner tree. Actually, acceptBranch() accepts all branches,</font>
00324 <font class="comment">// except branches that try to create a path from a channel to a partition when</font>
00325 <font class="comment">// there is already a path from another channel to that same partition. This</font>
00326 <font class="comment">// turned out necessary because graphSteiner() was a little bit too greedy ...</font>
00327 <font class="comment">//</font>
<a name="l00328"></a><a class="code" href="globRoute.C.html#a0">00328</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="globRoute.C.html#a0">acceptBranch</a>(<a class="code" href="class_sdfset.html">sdfset</a>&amp; branch, treeEdgeInfo&amp; steInfo)<font class="keyword">
</font>00329 <font class="keyword"></font>{
00330    sdfsetNextElmtIterator nextBranchEdge(&amp;branch);
00331    treeEdge *te;
00332    <font class="keywordflow">while</font> (te = (treeEdge *)nextBranchEdge())
00333    {
00334       <a class="code" href="class_expansiongridvertex.html">expansionGridVertex</a> *oneSide
00335      = (<a class="code" href="class_expansiongridvertex.html">expansionGridVertex</a> *) te-&gt;edge()-&gt;firstTerminal()-&gt;thisVertex();
00336       <font class="keywordflow">if</font> (<a class="code" href="globRoute.C.html#a1">checkThisEdgeSide</a>(te,oneSide,steInfo) == NIL)
00337      <font class="keywordflow">return</font> NIL;
00338       <a class="code" href="class_expansiongridvertex.html">expansionGridVertex</a> *otherSide
00339      = (<a class="code" href="class_expansiongridvertex.html">expansionGridVertex</a> *) te-&gt;edge()-&gt;lastTerminal()-&gt;thisVertex();
00340       <font class="keywordflow">if</font> (<a class="code" href="globRoute.C.html#a1">checkThisEdgeSide</a>(te,otherSide,steInfo) == NIL)
00341      <font class="keywordflow">return</font> NIL;
00342    }
00343    <font class="keywordflow">return</font> TRUE;         <font class="comment">// no reason to deny this branch</font>
00344 }
00345 
00346 
00347 <font class="comment">// Return NIL if VX represents a partition that already is incident with</font>
00348 <font class="comment">// another edge than TE. Return TRUE otherwise.</font>
00349 <font class="comment">//</font>
<a name="l00350"></a><a class="code" href="globRoute.C.html#a1">00350</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="globRoute.C.html#a1">checkThisEdgeSide</a>(treeEdge *te, <a class="code" href="class_expansiongridvertex.html">expansionGridVertex</a> *vx,
00351                  treeEdgeInfo&amp; steInfo)<font class="keyword">
</font>00352 <font class="keyword"></font>{
00353    <font class="keywordflow">if</font> (vx-&gt;<a class="code" href="class_expansiongridvertex.html#a5">type</a>() != PartitionGV)
00354       <font class="keywordflow">return</font> TRUE; <font class="comment">// we only worry about connections to partitions</font>
00355    graphVertexEdgeIterator nextEdge(vx);
00356    <a class="code" href="class_expansiongridedge.html">expansionGridEdge</a> *ege;
00357    <font class="keywordflow">while</font> (ege = (<a class="code" href="class_expansiongridedge.html">expansionGridEdge</a> *) nextEdge())
00358    {
00359       <font class="keywordflow">if</font> (te-&gt;edge() == ege)
00360      <font class="keywordflow">continue</font>;      <font class="comment">// this is our own edge</font>
00361       <font class="keywordflow">if</font> (steInfo.search(ege) != NIL)
00362      <font class="keywordflow">return</font> NIL;        <font class="comment">// this ege is already incident to VX</font>
00363    }
00364    <font class="keywordflow">return</font> TRUE;
00365 }
00366 
00367 
<a name="l00368"></a><a class="code" href="class_expansiongridedge.html#a8">00368</a> <font class="keywordtype">void</font> <a class="code" href="class_expansiongridedge.html#a8">expansionGridEdge::print</a>()<font class="keyword">
</font>00369 <font class="keyword"></font>{
00370    <font class="keywordtype">char</font> *s;
00371    <font class="keywordflow">if</font> (_direction == HorizontalEdge)
00372       s = <font class="stringliteral">"Hor"</font>;
00373    <font class="keywordflow">else</font>
00374       s = <font class="stringliteral">"Ver"</font>;
00375    cout &lt;&lt; form(<font class="stringliteral">"egE(%d,%d,%s) "</font>,_x,_y,s) &lt;&lt; flush;
00376 }
00377 
00378 
<a name="l00379"></a><a class="code" href="class_expansiongrid.html#c9">00379</a> <font class="keywordtype">void</font> <a class="code" href="class_expansiongrid.html#c9">expansionGrid::EGerror</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *msg)<font class="keyword">
</font>00380 <font class="keyword"></font>{
00381    cout &lt;&lt; flush;
00382    cerr &lt;&lt; msg;
00383    abort();
00384 }
00385 
00386 
00387 <font class="comment">// print an ascii representation of the route of a net:</font>
00388 <font class="comment">//</font>
<a name="l00389"></a><a class="code" href="class_expansiongrid.html#a10">00389</a> <font class="keywordtype">void</font>  <a class="code" href="class_expansiongrid.html#a10">expansionGrid::printRoute</a>(<a class="code" href="class_globnet.html">globNet</a> *globnet, ostream&amp; thestream)<font class="keyword">
</font>00390 <font class="keyword"></font>{
00391    <font class="keywordflow">for</font> (<font class="keywordtype">int</font> y = <a class="code" href="class_expansiongrid.html#a2">ny</a>()-1; y &gt;= 0; --y)
00392    {
00393       <font class="keywordtype">int</font> x;
00394       <font class="keywordflow">for</font> (x = 0; x &lt; <a class="code" href="class_expansiongrid.html#a1">nx</a>(); ++x)
00395       {
00396      <a class="code" href="class_expansiongridedge.html">expansionGridEdge</a> *e = <a class="code" href="class_expansiongrid.html#a8">findEdge</a>(thematrix[x][y],North);
00397      <font class="keywordflow">if</font> (e == NIL)
00398         <font class="keywordflow">continue</font>;
00399      <font class="keywordflow">if</font> (globnet-&gt;<a class="code" href="class_globnet.html#a5">isInRoute</a>(e))
00400         thestream &lt;&lt; <font class="stringliteral">"|"</font>;
00401      <font class="keywordflow">else</font>
00402         thestream &lt;&lt; <font class="stringliteral">" "</font>;
00403      <font class="keywordflow">if</font> ( x &lt; <a class="code" href="class_expansiongrid.html#a1">nx</a>()-1 )
00404         thestream &lt;&lt; <font class="stringliteral">" "</font>;
00405       }
00406       thestream &lt;&lt; endl;
00407       <font class="keywordflow">for</font> (x = 0; x &lt; <a class="code" href="class_expansiongrid.html#a1">nx</a>(); ++x)
00408       {
00409      <font class="keywordflow">switch</font> (thematrix[x][y]-&gt;type())
00410      {
00411      <font class="keywordflow">case</font> PartitionGV:
00412         <font class="keywordflow">if</font> (globnet-&gt;<a class="code" href="class_globnet.html#a6">isInNet</a>(thematrix[x][y]))
00413            thestream &lt;&lt; <font class="stringliteral">"x"</font>; <font class="comment">// required vertex is "x"</font>
00414         <font class="keywordflow">else</font>
00415            thestream &lt;&lt; <font class="stringliteral">"+"</font>; <font class="comment">// non-required vertex is "+"</font>
00416         <font class="keywordflow">break</font>;
00417      <font class="keywordflow">case</font> HorizontalChannelGV:
00418      <font class="keywordflow">case</font> VerticalChannelGV:
00419      <font class="keywordflow">case</font> ChannelCrossingGV:
00420         thestream &lt;&lt; <font class="stringliteral">"."</font>;
00421      }
00422      <a class="code" href="class_expansiongridedge.html">expansionGridEdge</a> *e = <a class="code" href="class_expansiongrid.html#a8">findEdge</a>(thematrix[x][y],East);
00423      <font class="keywordflow">if</font> (e == NIL)
00424         <font class="keywordflow">continue</font>;
00425      <font class="keywordflow">if</font> (globnet-&gt;<a class="code" href="class_globnet.html#a5">isInRoute</a>(e))
00426         thestream &lt;&lt; <font class="stringliteral">"_"</font>;
00427      <font class="keywordflow">else</font>
00428         thestream &lt;&lt; <font class="stringliteral">" "</font>;
00429       }
00430       thestream &lt;&lt; endl;
00431    }
00432 }
00433 
00434 
00435 <font class="comment">// print the routing summary that is in totalp-&gt;routing:</font>
00436 <font class="comment">//</font>
<a name="l00437"></a><a class="code" href="class_expansiongrid.html#a11">00437</a> <font class="keywordtype">void</font> <a class="code" href="class_expansiongrid.html#a11">expansionGrid::printRouting</a>(ostream&amp; thestream)<font class="keyword">
</font>00438 <font class="keyword"></font>{
00439    <a class="code" href="class__global_routing.html">GLOBAL_ROUTINGPTR</a> routing = totalp-&gt;routing;
00440    <font class="keywordflow">if</font> (routing == NIL)
00441       <font class="keywordflow">return</font>;
00442    <a class="code" href="class__routing_channel.html">ROUTING_CHANNEL</a> *ch_hor = routing-&gt;horizontal_channels;
00443    <a class="code" href="class__routing_channel.html">ROUTING_CHANNEL</a> *ch_ver = routing-&gt;vertical_channels;
00444    thestream &lt;&lt; <font class="stringliteral">"Horizontal channel heights [channel, nwires, ncells]:"</font> &lt;&lt; endl;
00445    <font class="keywordtype">int</font> i;
00446    <font class="keywordflow">for</font> (i = 0; i &lt; totalp-&gt;ny - 1; ++i)
00447       thestream &lt;&lt; form(<font class="stringliteral">"[%d %d %d] "</font>,i,ch_hor[i].nwires,ch_hor[i].ncells);
00448    thestream &lt;&lt; <font class="stringliteral">"\n\nVertical channel widths [channel, nwires, ncells]:"</font> &lt;&lt; endl;
00449    <font class="keywordflow">for</font> (i = 0; i &lt; totalp-&gt;nx - 1; ++i)
00450       thestream &lt;&lt; form(<font class="stringliteral">"[%d %d %d] "</font>,i,ch_ver[i].nwires,ch_ver[i].ncells);
00451    thestream &lt;&lt; <font class="stringliteral">"\n\nLocal channels [x, y, hor.nwires, ver.nwires]:"</font> &lt;&lt; endl;
00452    <font class="keywordflow">for</font> (<font class="keywordtype">int</font> j = totalp-&gt;ny - 1; j &gt;= 0; --j)
00453    {
00454       <font class="keywordflow">for</font> (i = 0; i &lt; totalp-&gt;nx; ++i)
00455       {
00456      <a class="code" href="class__routing_info.html">ROUTING_INFO</a>&amp; ch = routing-&gt;small_channels[i][j];
00457      thestream &lt;&lt; form(<font class="stringliteral">"[%d %d %d %d] "</font>,i,j,ch.channel[HOR].nwires,
00458                ch.channel[VER].nwires);
00459       }
00460       thestream &lt;&lt; endl;
00461    }
00462 }
00463 
00464 
00465 <font class="comment">// summarize the info in the edges of thegraph so as to obtain the required</font>
00466 <font class="comment">// channel densities:</font>
00467 <font class="comment">//</font>
<a name="l00468"></a><a class="code" href="class_expansiongrid.html#a6">00468</a> <font class="keywordtype">void</font> <a class="code" href="class_expansiongrid.html#a6">expansionGrid::summarizeGlobNets</a>()<font class="keyword">
</font>00469 <font class="keyword"></font>{
00470    <a class="code" href="class__global_routing.html">GLOBAL_ROUTINGPTR</a> routing = <font class="keyword">new</font> <a class="code" href="class__global_routing.html">GLOBAL_ROUTING</a>;
00471    totalp-&gt;routing = routing;
00472    routing-&gt;horizontal_channels = <font class="keyword">new</font> <a class="code" href="class__routing_channel.html">ROUTING_CHANNEL</a> [totalp-&gt;ny];
00473    routing-&gt;vertical_channels = <font class="keyword">new</font> <a class="code" href="class__routing_channel.html">ROUTING_CHANNEL</a> [totalp-&gt;nx];
00474    routing-&gt;small_channels = <font class="keyword">new</font> (<a class="code" href="class__routing_info.html">ROUTING_INFO</a> *[totalp-&gt;nx]);
00475    <font class="keywordtype">int</font> i;
00476    <font class="keywordflow">for</font> (i = 0; i &lt; totalp-&gt;nx; ++i)
00477       routing-&gt;small_channels[i] = <font class="keyword">new</font> <a class="code" href="class__routing_info.html">ROUTING_INFO</a> [totalp-&gt;ny];
00478    <font class="comment">// make routing info for all partitions [0..nx-1][0..ny-1]</font>
00479    <font class="keywordflow">for</font> (i = 0; i &lt; totalp-&gt;nx; ++i)
00480       <font class="keywordflow">for</font> (<font class="keywordtype">int</font> j = 0; j &lt;  totalp-&gt;ny; ++j)
00481      <a class="code" href="class_expansiongrid.html#c5">makeRoutingInfo</a>(routing-&gt;small_channels[i][j], i, j);
00482    <font class="comment">// summarize all the local vertical channels:</font>
00483    <font class="keywordflow">for</font> (i = 0; i &lt; totalp-&gt;nx; ++i)
00484       <a class="code" href="class_expansiongrid.html#c6">sumRoutingInfo</a>(VER, i, routing-&gt;vertical_channels[i]);
00485    <font class="comment">// ...and summarize the local horizontal channels:</font>
00486    <font class="keywordflow">for</font> (i = 0; i &lt; totalp-&gt;ny; ++i)
00487       <a class="code" href="class_expansiongrid.html#c6">sumRoutingInfo</a>(HOR, i, routing-&gt;horizontal_channels[i]);
00488 }
00489 
00490 
00491 <font class="comment">// Compute the width of the horizontal and vertical channel to (respectively)</font>
00492 <font class="comment">// the top and the right of the partition [x][y]:</font>
00493 <font class="comment">//</font>
<a name="l00494"></a><a class="code" href="class_expansiongrid.html#c5">00494</a> <font class="keywordtype">void</font> <a class="code" href="class_expansiongrid.html#c5">expansionGrid::makeRoutingInfo</a>(<a class="code" href="class__routing_info.html">ROUTING_INFO</a>&amp; rinfo, <font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y)<font class="keyword">
</font>00495 <font class="keyword"></font>{
00496    <font class="keywordtype">int</font> matrix_x = 2*x;      <font class="comment">// the inverse operation of instance2xy()</font>
00497    <font class="keywordtype">int</font> matrix_y = 2*y;
00498    <a class="code" href="class__routing_channel.html">ROUTING_CHANNEL</a>&amp; ch_hor = rinfo.channel[HOR];
00499    <a class="code" href="class__routing_channel.html">ROUTING_CHANNEL</a>&amp; ch_ver = rinfo.channel[VER];
00500    ch_hor.nwires = <a class="code" href="class_expansiongrid.html#a7">nwires</a>(West, East, matrix_x, matrix_y+1, &amp;ch_hor.length);
00501    ch_hor.ncells = <a class="code" href="class_expansiongrid.html#a9">roundWiresToCells</a>(HOR, ch_hor.nwires);
00502    ch_ver.nwires = <a class="code" href="class_expansiongrid.html#a7">nwires</a>(South, North, matrix_x+1, matrix_y, &amp;ch_ver.length);
00503    ch_ver.ncells = <a class="code" href="class_expansiongrid.html#a9">roundWiresToCells</a>(VER, ch_ver.nwires);
00504 }
00505 
00506 
00507 <font class="comment">// return the number of wires that pass through the vertex [x,y] in the</font>
00508 <font class="comment">// specified direction. This actually computes the maximum of the wires through</font>
00509 <font class="comment">// the edge on the south and the north side, or the maximum of the wires</font>
00510 <font class="comment">// through the edges on the west and the east side. (Depending on the specified</font>
00511 <font class="comment">// direction). If the LENGTH pointer is non-nil then it is used to output the</font>
00512 <font class="comment">// total length of the wiring channel:</font>
00513 <font class="comment">//</font>
<a name="l00514"></a><a class="code" href="class_expansiongrid.html#a7">00514</a> <font class="keywordtype">int</font> <a class="code" href="class_expansiongrid.html#a7">expansionGrid::nwires</a>(pointOfCompass poc1, pointOfCompass poc2,
00515               <font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y, <font class="keywordtype">int</font> *length)<font class="keyword">
</font>00516 <font class="keyword"></font>{
00517    <font class="keywordflow">if</font> (length) *length = 0;
00518    <font class="keywordflow">if</font> (x &gt;= thematrix.<a class="code" href="class_matrixgrid.html#a4">dimension1</a>() || y &gt;= thematrix.<a class="code" href="class_matrixgrid.html#a5">dimension2</a>())
00519       <font class="keywordflow">return</font> 0;         <font class="comment">// this channel does not exist!</font>
00520    <font class="comment">// (poc1, poc2) is either (South, North) or (East, West)</font>
00521    <a class="code" href="class_expansiongridvertex.html">expansionGridVertex</a> *vx = thematrix[x][y];
00522    <a class="code" href="class_expansiongridedge.html">expansionGridEdge</a> *oneSide = <a class="code" href="class_expansiongrid.html#a8">findEdge</a>(vx, poc1);
00523    <a class="code" href="class_expansiongridedge.html">expansionGridEdge</a> *otherSide = <a class="code" href="class_expansiongrid.html#a8">findEdge</a>(vx, poc2);
00524    <font class="keywordtype">int</font> nwiresOneSide = 0, nwiresOtherSide = 0;
00525    <font class="keywordflow">if</font> (oneSide != NIL)
00526    {
00527       nwiresOneSide = oneSide-&gt;<a class="code" href="class_expansiongridedge.html#a1">addToOccupation</a>(0);
00528       <font class="keywordflow">if</font> (length) *length += oneSide-&gt;<a class="code" href="class_expansiongridedge.html#a6">length</a>();
00529    }
00530    <font class="keywordflow">if</font> (otherSide != NIL)
00531    {
00532       nwiresOtherSide = otherSide-&gt;<a class="code" href="class_expansiongridedge.html#a1">addToOccupation</a>(0);
00533       <font class="keywordflow">if</font> (length) *length += otherSide-&gt;<a class="code" href="class_expansiongridedge.html#a6">length</a>();
00534    }
00535    <font class="keywordflow">if</font> (nwiresOneSide &gt; nwiresOtherSide)
00536       <font class="keywordflow">return</font> nwiresOneSide;
00537    <font class="keywordflow">else</font>
00538       <font class="keywordflow">return</font> nwiresOtherSide;
00539 }
00540 
00541 
00542 <font class="comment">// return how many core cells are needed to contain n_wires in the specified</font>
00543 <font class="comment">// channelDirection:</font>
00544 <font class="comment">//</font>
<a name="l00545"></a><a class="code" href="class_expansiongrid.html#a9">00545</a> <font class="keywordtype">int</font> <a class="code" href="class_expansiongrid.html#a9">expansionGrid::roundWiresToCells</a>(<font class="keywordtype">int</font> channelDirection, <font class="keywordtype">int</font> n_wires)<font class="keyword">
</font>00546 <font class="keyword"></font>{
00547    <font class="comment">// the width of a channel is a multiple of the core cell size in the</font>
00548    <font class="comment">// direction that is *orthogonal* to the channelDirection:</font>
00549    <font class="keywordtype">int</font> notChannelDirection = HOR;
00550    <font class="keywordflow">if</font> (channelDirection == HOR) notChannelDirection = VER;
00551    <font class="keywordtype">int</font> imageSize = image-&gt;size[notChannelDirection]; <font class="comment">// size of a core cell</font>
00552    <font class="keywordtype">int</font> n_cells = (n_wires + imageSize - 1) / imageSize; <font class="comment">// round up</font>
00553    <font class="keywordflow">return</font> n_cells;
00554 }
00555 
00556 
00557 <font class="comment">// summarize and maximize the information in the small_channels to obtain the</font>
00558 <font class="comment">// information for the horizontal_channels and the vertical_channels:</font>
00559 <font class="comment">//</font>
<a name="l00560"></a><a class="code" href="class_expansiongrid.html#c6">00560</a> <font class="keywordtype">void</font> <a class="code" href="class_expansiongrid.html#c6">expansionGrid::sumRoutingInfo</a>(<font class="keywordtype">int</font> direction, <font class="keywordtype">int</font> i, <a class="code" href="class__routing_channel.html">ROUTING_CHANNEL</a>&amp; channel_i)<font class="keyword">
</font>00561 <font class="keyword"></font>{
00562    <font class="keywordtype">int</font> length = 0;
00563    <font class="keywordtype">int</font> ncells = 0;
00564    <font class="keywordtype">int</font> nwires = 0;
00565    <font class="keywordtype">int</font> j;
00566    <a class="code" href="class__global_routing.html">GLOBAL_ROUTINGPTR</a> routing = totalp-&gt;routing;
00567    <font class="keywordflow">if</font> (routing == NIL)
00568       <a class="code" href="class_expansiongrid.html#c9">EGerror</a>(<font class="stringliteral">"INTERNAL: cannot summarize non-existing info!"</font>);
00569    <font class="keywordflow">if</font> (direction == HOR)
00570       <font class="comment">// compute the density of the horizontal slicing channel i:</font>
00571       <font class="keywordflow">for</font> (j=0; j &lt; totalp-&gt;nx - 1; ++j)
00572       {
00573      <a class="code" href="class__routing_channel.html">ROUTING_CHANNEL</a>&amp; ch = routing-&gt;small_channels[j][i].channel[HOR];
00574      <font class="comment">// take the maximum of everything and the sum of the lengths:</font>
00575      <font class="keywordflow">if</font> (ch.nwires &gt; nwires) nwires = ch.nwires;
00576      <font class="keywordflow">if</font> (ch.ncells &gt; ncells) ncells = ch.ncells;
00577      length += ch.length;
00578       }
00579    <font class="keywordflow">else</font> <font class="keywordflow">if</font> (direction == VER)
00580       <font class="comment">// compute the density of the vertical slicing channel i:</font>
00581       <font class="keywordflow">for</font> (j=0; j &lt; totalp-&gt;ny - 1; ++j)
00582       {
00583      <a class="code" href="class__routing_channel.html">ROUTING_CHANNEL</a>&amp; ch = routing-&gt;small_channels[i][j].channel[VER];
00584      <font class="comment">// take the maximum of everything and the sum of the lengths:</font>
00585      <font class="keywordflow">if</font> (ch.nwires &gt; nwires) nwires = ch.nwires;
00586      <font class="keywordflow">if</font> (ch.ncells &gt; ncells) ncells = ch.ncells;
00587      length += ch.length;
00588       }
00589    <font class="keywordflow">else</font>
00590       <a class="code" href="class_expansiongrid.html#c9">EGerror</a>(<font class="stringliteral">"INTERNAL: illegal direction for sumRoutingInfo()"</font>);
00591    channel_i.length = length;
00592    channel_i.ncells = ncells;
00593    channel_i.nwires = nwires;
00594 }
00595 
00596 
00597 <font class="comment">// return the expansionGridEdge that is incident to V in the direction POC:</font>
00598 <font class="comment">//</font>
<a name="l00599"></a><a class="code" href="class_expansiongrid.html#a8">00599</a> <a class="code" href="class_expansiongridedge.html">expansionGridEdge</a> *<a class="code" href="class_expansiongrid.html#a8">expansionGrid::findEdge</a>(<a class="code" href="class_expansiongridvertex.html">expansionGridVertex</a> *v,
00600                        pointOfCompass poc)<font class="keyword">
</font>00601 <font class="keyword"></font>{
00602    graphVertexTerminalIterator nextTerm(v);
00603    <a class="code" href="class_expansiongridterminal.html">expansionGridTerminal</a> *t;
00604    <font class="keywordflow">while</font> ( t = (<a class="code" href="class_expansiongridterminal.html">expansionGridTerminal</a> *) nextTerm() )
00605       <font class="keywordflow">if</font> ( t-&gt;<a class="code" href="class_expansiongridterminal.html#a1">compass</a>() == poc )
00606      <font class="keywordflow">break</font>;
00607    <font class="keywordflow">if</font> ( t == NIL )
00608       <font class="keywordflow">return</font> NIL;
00609    <font class="keywordflow">else</font>
00610       <font class="keywordflow">return</font> (<a class="code" href="class_expansiongridedge.html">expansionGridEdge</a> *) t-&gt;thisEdge();
00611 }
00612 
00613 
00614 <font class="comment">// return TRUE if E is an edge in the global route of this globNet:</font>
00615 <font class="comment">//</font>
<a name="l00616"></a><a class="code" href="class_globnet.html#a5">00616</a> <font class="keywordtype">int</font> <a class="code" href="class_globnet.html#a5">globNet::isInRoute</a>(<a class="code" href="class_expansiongridedge.html">expansionGridEdge</a> *e)<font class="keyword">
</font>00617 <font class="keyword"></font>{
00618    sdfsetNextElmtIterator nextEdge(&amp;route);
00619    treeEdge *te;
00620    <font class="keywordflow">while</font> (te = (treeEdge *) nextEdge())
00621       <font class="keywordflow">if</font> (te-&gt;edge() == e)
00622      <font class="keywordflow">return</font> TRUE;
00623    <font class="keywordflow">return</font> NIL;
00624 }
00625 
00626 
00627 <font class="comment">// return TRUE if V is a required vertex of the global route:</font>
00628 <font class="comment">//</font>
<a name="l00629"></a><a class="code" href="class_globnet.html#a6">00629</a> <font class="keywordtype">int</font> <a class="code" href="class_globnet.html#a6">globNet::isInNet</a>(<a class="code" href="class_expansiongridvertex.html">expansionGridVertex</a> *v)<font class="keyword">
</font>00630 <font class="keyword"></font>{
00631    sdfsetNextElmtIterator nextVx(<font class="keyword">this</font>);
00632    <a class="code" href="class_treevertex.html">treeVertex</a> *tvx;
00633    <font class="keywordflow">while</font> (tvx = (<a class="code" href="class_treevertex.html">treeVertex</a> *)nextVx())
00634       <font class="keywordflow">if</font> (tvx-&gt;vertex() == v)
00635      <font class="keywordflow">return</font> TRUE;
00636    <font class="keywordflow">return</font> NIL;
00637 }
00638 
00639 
00640 <font class="comment">// OK, this is horribly primitive, but it works in most cases ...:</font>
<a name="l00641"></a><a class="code" href="globRoute.C.html#a3">00641</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="globRoute.C.html#a3">isPowerOrGroundNet</a>(NETPTR net)<font class="keyword">
</font>00642 <font class="keyword"></font>{
00643    <font class="keywordflow">if</font> (strncmp(net-&gt;name,"vss",3) == 0) <font class="keywordflow">return</font> TRUE;
00644    <font class="keywordflow">if</font> (strncmp(net-&gt;name,"VSS",3) == 0) <font class="keywordflow">return</font> TRUE;
00645    <font class="keywordflow">if</font> (strncmp(net-&gt;name,"gnd",3) == 0) <font class="keywordflow">return</font> TRUE;
00646    <font class="keywordflow">if</font> (strncmp(net-&gt;name,"GND",3) == 0) <font class="keywordflow">return</font> TRUE;
00647    <font class="keywordflow">if</font> (strncmp(net-&gt;name,"vdd",3) == 0) <font class="keywordflow">return</font> TRUE;
00648    <font class="keywordflow">if</font> (strncmp(net-&gt;name,"VDD",3) == 0) <font class="keywordflow">return</font> TRUE;
00649    <font class="keywordflow">return</font> NIL;
00650 }
</div></pre><hr><address><small>Generated at Thu Sep 28 15:37:56 2000 for madonna by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align=center border=0 
width=110 height=53></a>1.1.5 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy; 1997-2000</small></address>
</body>
</html>
